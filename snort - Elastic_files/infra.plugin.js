/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e,t,r,i={16438:(e,t,r)=>{"use strict";r.d(t,{kY:()=>i});const i="observability-logs-explorer"},68597:(e,t,r)=>{"use strict";r.d(t,{Zh:()=>i});const i="observability:enableLogsStream"},82708:(e,t,r)=>{"use strict";r.d(t,{Ov:()=>i});const i={APM:"apm",LOGS:"logs",INFRASTRUCTURE:"infrastructure",OBSERVABILITY:"observability",SLO:"slo",SIEM:"siem",UPTIME:"uptime",ML:"ml",STACK_ALERTS:"stackAlerts",EXAMPLE:"AlertingExample",MONITORING:"monitoring",ALERTS:"alerts",DISCOVER:"discover"};Object.values(i).map((e=>e))},69219:(e,t,r)=>{"use strict";r.d(t,{BI:()=>O,Cl:()=>S,DW:()=>p,Ez:()=>b,Kp:()=>_,Rn:()=>w,Ry:()=>y,S2:()=>o,SL:()=>T,Wp:()=>d,ZQ:()=>D,_9:()=>L,at:()=>f,fJ:()=>A,gH:()=>n,h:()=>v,h9:()=>u,ht:()=>i,i2:()=>c,lj:()=>h,pR:()=>m,qT:()=>k,sR:()=>M,tU:()=>E,tV:()=>R,tg:()=>g,vT:()=>s,xv:()=>l,z1:()=>x,zt:()=>a});const i="@timestamp",s="kibana",a=`${s}.alert`,n=`${a}.rule`,o=`${s}.space_ids`,l=`${s}.version`,c=`${a}.action_group`,u=`${a}.case_ids`,d=`${a}.duration.us`,p=`${a}.end`,g=`${a}.flapping`,h=`${a}.maintenance_window_ids`,m=`${a}.instance.id`,f=`${a}.reason`,_=`${a}.start`,b=`${a}.status`,y=`${a}.time_range`,v=`${a}.uuid`,T=`${a}.workflow_status`,E=`${a}.workflow_tags`,S=`${a}.workflow_assignee_ids`,O=`${n}.category`,A=`${n}.consumer`,x=`${n}.execution.uuid`,k=`${n}.name`,D=`${n}.parameters`,w=`${n}.producer`,M=`${n}.tags`,R=`${n}.rule_type_id`,L=`${n}.uuid`},69397:(e,t,r)=>{"use strict";r.d(t,{Yj:()=>o,lN:()=>l,lV:()=>p,n8:()=>c,wE:()=>i});const i="observability.rules.custom_threshold";let s=function(e){return e.ErrorCount="apm.error_rate",e.TransactionErrorRate="apm.transaction_error_rate",e.TransactionDuration="apm.transaction_duration",e.Anomaly="apm.anomaly",e}({});const a=Object.values(s),n=["xpack.synthetics.alerts.monitorStatus","xpack.synthetics.alerts.tls"],o="metrics.alert.inventory.threshold",l="metrics.alert.threshold",c="logs.alert.document.count",u=[c];let d=function(e){return e.MetricThreshold="metrics.alert.threshold",e.InventoryThreshold="metrics.alert.inventory.threshold",e}({});const p=[...a,...n,...Object.values(d),"xpack.uptime.alerts.tls","xpack.uptime.alerts.tlsCertificate","xpack.uptime.alerts.monitorStatus","xpack.uptime.alerts.durationAnomaly",...u,"slo.rules.burnRate",i]},5919:(e,t,r)=>{"use strict";r.d(t,{jg:()=>h,Sd:()=>m,Xk:()=>g});var i=r(80190),s=r(84286);r(55964);var a=r(4513),n=r.n(a);const o=e=>Boolean(e&&void 0!==(null==e?void 0:e.timeRange$)),l=e=>Boolean(e&&o(e)&&(e=>Boolean(e&&void 0!==(null==e?void 0:e.filters$)))(e)&&void 0!==(null==e?void 0:e.query$)),c=e=>Boolean(e&&void 0!==(null==e?void 0:e.searchSessionId$)),u=e=>Boolean(e&&void 0!==(null==e?void 0:e.parentApi));function d(e,t){var r,i,s,a,n,o,l,c,u,d,p,g,h;const m=e;return{isReload:t,filters:null==m||null===(r=m.parentApi)||void 0===r||null===(i=r.filters$)||void 0===i?void 0:i.value,query:null==m||null===(s=m.parentApi)||void 0===s||null===(a=s.query$)||void 0===a?void 0:a.value,searchSessionId:null==m||null===(n=m.parentApi)||void 0===n||null===(o=n.searchSessionId$)||void 0===o?void 0:o.value,timeRange:null!==(l=null==m||null===(c=m.timeRange$)||void 0===c?void 0:c.value)&&void 0!==l?l:null==m||null===(u=m.parentApi)||void 0===u||null===(d=u.timeRange$)||void 0===d?void 0:d.value,timeslice:null!=m&&null!==(p=m.timeRange$)&&void 0!==p&&p.value||null==m||null===(g=m.parentApi)||void 0===g||null===(h=g.timeslice$)||void 0===h?void 0:h.value}}function p(e){return!(!u(e)||!c(e.parentApi))&&"string"==typeof e.parentApi.searchSessionId$.value}const g=e=>{const t=(0,s.useMemo)((()=>new i.BehaviorSubject(d(e,!1))),[]);return(0,s.useEffect)((()=>{const r=function(e){const t=function(e){const t=[];if(o(e)&&t.push(e.timeRange$.pipe((0,i.skip)(1))),u(e)&&l(e.parentApi)&&t.push((0,i.combineLatest)([e.parentApi.filters$,e.parentApi.query$]).pipe((0,i.skip)(1),(0,i.filter)((()=>!p(e))))),u(e)&&o(e.parentApi)){const r=[e.parentApi.timeRange$];e.parentApi.timeslice$&&r.push(e.parentApi.timeslice$),t.push((0,i.combineLatest)(r).pipe((0,i.skip)(1),(0,i.filter)((()=>!p(e)&&!function(e){return!!o(e)&&"object"==typeof e.timeRange$.value}(e)))))}return t}(e),r=function(e){const t=[];var r;return u(e)&&c(e.parentApi)&&t.push(e.parentApi.searchSessionId$.pipe((0,i.skip)(1))),u(e)&&(r=e.parentApi,Boolean(r&&void 0!==(null==r?void 0:r.reload$)))&&t.push(e.parentApi.reload$.pipe((0,i.filter)((()=>!p(e))))),t}(e);if(0===r.length)return(0,i.merge)(...t).pipe((0,i.startWith)(d(e,!1)),(0,i.debounceTime)(0),(0,i.map)((()=>d(e,!1))));const s=new i.Subject,a=(0,i.merge)(...t).pipe((0,i.switchMap)((t=>(0,i.of)(t).pipe((0,i.delay)(0),(0,i.takeUntil)(s),(0,i.map)((()=>d(e,!1))))))),n=(0,i.merge)(...r).pipe((0,i.tap)((()=>s.next())),(0,i.map)((()=>d(e,!0))));return(0,i.merge)(n,a).pipe((0,i.startWith)(d(e,!1)))}(e).subscribe((e=>t.next(e)));return()=>r.unsubscribe()}),[]),(e=>{const t=(0,s.useRef)(!0),[r,a]=(0,s.useState)(null==e?void 0:e.getValue());return(0,s.useEffect)((()=>{if(t.current?t.current=!1:a(null==e?void 0:e.getValue()),!e)return;const r=e.pipe((0,i.skip)(1)).subscribe((e=>a(e)));return()=>r.unsubscribe()}),[e]),r})(t)},h=e=>{const t=new i.BehaviorSubject(e.timeRange);function r(e){t.next(e)}return{serialize:()=>({timeRange:t.value}),comparators:{timeRange:[t,r,n()]},api:{timeRange$:t,setTimeRange:r}}},m=e=>{const t=new i.BehaviorSubject(e.title),r=new i.BehaviorSubject(e.description),s=new i.BehaviorSubject(e.hidePanelTitles),a=e=>{e!==t.value&&t.next(e)},n=e=>{e!==s.value&&s.next(e)},o=e=>{e!==r.value&&r.next(e)};return{api:{title$:t,hideTitle$:s,setTitle:a,setHideTitle:n,description$:r,setDescription:o},comparators:{title:[t,a],description:[r,o],hidePanelTitles:[s,n,(e,t)=>Boolean(e)===Boolean(t)]},serialize:()=>({title:t.value,hidePanelTitles:s.value,description:r.value})}}},48786:(e,t,r)=>{"use strict";r.d(t,{o:()=>i});let i=function(e){return e.GREATER_THAN=">",e.GREATER_THAN_OR_EQUALS=">=",e.BETWEEN="between",e.LESS_THAN="<",e.LESS_THAN_OR_EQUALS="<=",e.NOT_BETWEEN="notBetween",e}({})},22584:(e,t,r)=>{"use strict";r.d(t,{O5:()=>i.O5,PZ:()=>i.PZ,Xc:()=>i.Xc,_2:()=>i._2,cw:()=>i.cw,fH:()=>i.fH,jL:()=>i.jL});var i=r(88169)},88169:(e,t,r)=>{"use strict";r.d(t,{fH:()=>l,cw:()=>u,jL:()=>d,PZ:()=>o.n8,kq:()=>p,Nn:()=>m,fF:()=>L,Gj:()=>R,tx:()=>T,er:()=>q,O5:()=>w,_2:()=>M,Xc:()=>D,lX:()=>v,mq:()=>y});var i=r(75008),s=r(43782),a=r(66764);const n=s.type({_shards:s.type({total:s.number,successful:s.number,skipped:s.number,failed:s.number}),timed_out:s.boolean,took:s.number});var o=r(69397);s.keyof({count:null,ratio:null});let l=function(e){return e.GT="more than",e.GT_OR_EQ="more than or equals",e.LT="less than",e.LT_OR_EQ="less than or equals",e.EQ="equals",e.NOT_EQ="does not equal",e.MATCH="matches",e.NOT_MATCH="does not match",e.MATCH_PHRASE="matches phrase",e.NOT_MATCH_PHRASE="does not match phrase",e}({});const c=s.keyof({[l.GT]:null,[l.GT_OR_EQ]:null,[l.LT]:null,[l.LT_OR_EQ]:null,[l.EQ]:null,[l.NOT_EQ]:null,[l.MATCH]:null,[l.NOT_MATCH]:null,[l.MATCH_PHRASE]:null,[l.NOT_MATCH_PHRASE]:null}),u={[l.GT]:i.i18n.translate("xpack.infra.logs.alerting.comparator.gt",{defaultMessage:"more than"}),[l.GT_OR_EQ]:i.i18n.translate("xpack.infra.logs.alerting.comparator.gtOrEq",{defaultMessage:"more than or equals"}),[l.LT]:i.i18n.translate("xpack.infra.logs.alerting.comparator.lt",{defaultMessage:"less than"}),[l.LT_OR_EQ]:i.i18n.translate("xpack.infra.logs.alerting.comparator.ltOrEq",{defaultMessage:"less than or equals"}),[l.EQ]:i.i18n.translate("xpack.infra.logs.alerting.comparator.eq",{defaultMessage:"is"}),[l.NOT_EQ]:i.i18n.translate("xpack.infra.logs.alerting.comparator.notEq",{defaultMessage:"is not"}),[`${l.EQ}:number`]:i.i18n.translate("xpack.infra.logs.alerting.comparator.eqNumber",{defaultMessage:"equals"}),[`${l.NOT_EQ}:number`]:i.i18n.translate("xpack.infra.logs.alerting.comparator.notEqNumber",{defaultMessage:"does not equal"}),[l.MATCH]:i.i18n.translate("xpack.infra.logs.alerting.comparator.match",{defaultMessage:"matches"}),[l.NOT_MATCH]:i.i18n.translate("xpack.infra.logs.alerting.comparator.notMatch",{defaultMessage:"does not match"}),[l.MATCH_PHRASE]:i.i18n.translate("xpack.infra.logs.alerting.comparator.matchPhrase",{defaultMessage:"matches phrase"}),[l.NOT_MATCH_PHRASE]:i.i18n.translate("xpack.infra.logs.alerting.comparator.notMatchPhrase",{defaultMessage:"does not match phrase"})},d={[l.GT]:">",[l.GT_OR_EQ]:"≥",[l.LT]:"<",[l.LT_OR_EQ]:"≤",[l.EQ]:"=",[l.NOT_EQ]:"≠",[`${l.EQ}:number`]:"=",[`${l.NOT_EQ}:number`]:"≠",[l.MATCH]:i.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.match",{defaultMessage:"matches"}),[l.NOT_MATCH]:i.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.notMatch",{defaultMessage:"does not match"}),[l.MATCH_PHRASE]:i.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.matchPhrase",{defaultMessage:"matches phrase"}),[l.NOT_MATCH_PHRASE]:i.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.notMatchPhrase",{defaultMessage:"does not match phrase"})},p=s.type({comparator:c,value:s.number}),g=s.type({field:s.string,comparator:c,value:s.union([s.string,s.number])}),h=s.partial(g.props),m=s.array(g),f=s.array(h),_=s.tuple([m,m]),b=s.tuple([f,f]),y=(s.union([f,b]),s.union([s.literal("s"),s.literal("m"),s.literal("h"),s.literal("d")])),v=s.number,T=s.array(s.string),E=s.type({count:p,timeUnit:y,timeSize:v,logView:a.persistedLogViewReferenceRT}),S=(s.partial(E.props),s.partial({groupBy:T})),O=s.intersection([s.type({criteria:m,...E.props}),s.partial({...S.props})]),A=s.intersection([s.type({criteria:f,...E.props}),s.partial({...S.props})]),x=s.intersection([s.type({criteria:_,...E.props}),s.partial({...S.props})]),k=s.intersection([s.type({criteria:b,...E.props}),s.partial({...S.props})]),D=s.union([O,x]),w=(s.union([A,k]),e=>!!(e.length>0&&Array.isArray(e[0]))),M=e=>w(e.criteria),R=e=>e[0],L=e=>e[1],C=s.type({key:s.number,doc_count:s.number}),I=s.type({hits:s.type({hits:s.array(s.type({fields:s.record(s.string,s.array(s.unknown))}))})}),P=s.partial({histogramBuckets:s.type({buckets:s.array(C)})}),j=s.partial({additionalContext:I}),F=s.type({total:s.type({value:s.number})}),U=s.type({key:s.record(s.string,s.string),doc_count:s.number}),V=s.partial({after_key:s.record(s.string,s.string)}),$=(s.intersection([n,s.intersection([s.type({hits:F}),s.partial({aggregations:s.intersection([P,j])})])]),s.intersection([n,s.type({aggregations:s.type({groups:s.intersection([s.type({buckets:s.array(s.type({...U.props,filtered_results:s.intersection([s.type({doc_count:s.number}),P,j])}))}),V])}),hits:F})])),H=s.intersection([n,s.type({aggregations:s.type({groups:s.intersection([s.type({buckets:s.array(s.intersection([U,P,j]))}),V])}),hits:F})]),q=(s.union([$,H]),(e,t)=>e===l.GT||"number"==typeof t&&e===l.GT_OR_EQ&&t>0)},4332:(e,t,r)=>{"use strict";r.d(t,{J2:()=>a,Yj:()=>s,lN:()=>i,H2:()=>n});const i="metrics.alert.threshold",s="metrics.alert.inventory.threshold";let a=function(e){return e.COUNT="count",e.AVERAGE="avg",e.SUM="sum",e.MIN="min",e.MAX="max",e.RATE="rate",e.CARDINALITY="cardinality",e.P95="p95",e.P99="p99",e.CUSTOM="custom",e}({});const n=Symbol("QUERY_INVALID")},22787:(e,t,r)=>{"use strict";r.d(t,{CE:()=>m,KN:()=>h,W3:()=>n,WK:()=>l,ah:()=>a,ko:()=>o,l0:()=>g,mc:()=>u,nx:()=>c,p:()=>f,pD:()=>p,rc:()=>d,w3:()=>s});var i=r(82708);const s="metrics-*,metricbeat-*",a="metrics",n="logs",o=(i.Ov.INFRASTRUCTURE,i.Ov.INFRASTRUCTURE,i.Ov.LOGS,[i.Ov.INFRASTRUCTURE,i.Ov.OBSERVABILITY,i.Ov.LOGS,i.Ov.SLO,i.Ov.APM,i.Ov.ALERTS]),l="@timestamp",c="process.command_line",u="host.name",d="container.id",p="kubernetes.pod.uid",g="system",h=9e5,m={name:"Metrics View",timeFieldName:l},f=20},92105:(e,t,r)=>{"use strict";r.d(t,{F:()=>b,Y:()=>g});var i=r(75008),s=r(66764),a=r(22584),n=r(92503),o=r(69219);const l=e=>({fields:t})=>{var r;const i=null!==(r=t[o.at])&&void 0!==r?r:"",s=t[o.Kp],a=null!=s?new Date(s).valueOf():void 0,n=e.getRedirectUrl({time:a});return{reason:i,link:c(n)}},c=e=>{const t=e.indexOf("/app/");return e.substring(t)};var u=r(60053);const d=i.i18n.translate("xpack.infra.logs.alerting.threshold.defaultActionMessage",{defaultMessage:"'{{context.reason}}'\n\n'{{rule.name}}' is active.\n\n'{{^context.isRatio}}{{#context.group}}{{context.group}}' - '{{/context.group}}{{context.matchingDocuments}}' log entries have matched the following conditions: '{{context.conditions}}{{/context.isRatio}}'\n'{{#context.isRatio}}{{#context.group}}{{context.group}}' - '{{/context.group}}' Ratio of the count of log entries matching '{{context.numeratorConditions}}' to the count of log entries matching '{{context.denominatorConditions}}' was '{{context.ratio}}{{/context.isRatio}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),p=i.i18n.translate("xpack.infra.logs.alerting.threshold.defaultRecoveryMessage",{defaultMessage:"'{{rule.name}}' has recovered.\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"});function g(e,t){const o=(0,n.bj)(e,(()=>Promise.all([r.e(94),r.e(133),r.e(952),r.e(717)]).then(r.bind(r,31683)))),c=(0,n.bj)(e,(()=>Promise.all([r.e(94),r.e(213)]).then(r.bind(r,76213)))),{logsLocator:g}=(0,s.getLogsLocatorsFromUrlService)(t);return{id:a.PZ,description:i.i18n.translate("xpack.infra.logs.alertFlyout.alertDescription",{defaultMessage:"Alert when the log aggregation exceeds the threshold."}),iconClass:"bell",documentationUrl:e=>`${e.links.observability.logsThreshold}`,alertDetailsAppSection:c,ruleParamsExpression:o,validate:u.P1,defaultActionMessage:d,defaultRecoveryMessage:p,requiresAppContext:!1,format:l(g),priority:30}}var h=r(84286),m=r.n(h),f=r(96791);const _=m().lazy((()=>r.e(434).then(r.bind(r,28434)))),b=()=>(0,f.jsx)(m().Suspense,{fallback:(0,f.jsx)("div",null)},(0,f.jsx)(_,null))},60053:(e,t,r)=>{"use strict";r.d(t,{CA:()=>u,P1:()=>d});var i=r(75008),s=r(43782),a=r(30770),n=r(88169);const o=s.type({field:s.array(s.string),comparator:s.array(s.string),value:s.array(s.string)}),l=s.record(s.string,o),c=s.recursion("AlertingError",(()=>s.record(s.string,s.union([s.string,s.array(s.string),c])))),u=s.type({threshold:s.type({value:s.array(s.string)}),criteria:s.record(s.string,l),timeWindowSize:s.array(s.string),timeSizeUnit:s.array(s.string)});function d({count:e,criteria:t,timeSize:r}){const s={errors:{}},o={threshold:{value:[]},criteria:{},timeSizeUnit:[],timeWindowSize:[]};if(s.errors=o,(0,a.isNumber)(null==e?void 0:e.value)||(0,a.isFinite)(null==e?void 0:e.value)||o.threshold.value.push(i.i18n.translate("xpack.infra.logs.alertFlyout.error.thresholdRequired",{defaultMessage:"Numeric threshold value is Required."})),r||o.timeWindowSize.push(i.i18n.translate("xpack.infra.logs.alertFlyout.error.timeSizeRequired",{defaultMessage:"Time size is Required."})),t&&t.length>0){const e=e=>{const t={};return e.forEach(((e,r)=>{t[r]={field:[],comparator:[],value:[]},e.field||t[r].field.push(i.i18n.translate("xpack.infra.logs.alertFlyout.error.criterionFieldRequired",{defaultMessage:"Field is required."})),e.comparator||t[r].comparator.push(i.i18n.translate("xpack.infra.logs.alertFlyout.error.criterionComparatorRequired",{defaultMessage:"Comparator is required."})),void 0!==e.value&&null!==e.value||t[r].value.push(i.i18n.translate("xpack.infra.logs.alertFlyout.error.criterionValueRequired",{defaultMessage:"Value is required."}))})),t};if((0,n.O5)(t)){const r=e((0,n.Gj)(t));o.criteria[0]=r;const i=e((0,n.fF)(t));o.criteria[1]=i}else{const r=e(t);o.criteria[0]=r}}return s}},45266:(e,t,r)=>{"use strict";r.d(t,{L:()=>s,i:()=>i});const i="LOG_STREAM_EMBEDDABLE",s="ADD_SEARCH_ACTION_ID"},92503:(e,t,r)=>{"use strict";r.d(t,{Q7:()=>u,bZ:()=>l,bj:()=>g,ei:()=>p,fJ:()=>c,vH:()=>d});var i=r(84286),s=r.n(i),a=r(20409),n=r(96791);const o=(e,t,r)=>(0,a.createKibanaReactContext)({...e,...t,...r}),l=(0,i.createContext)({}),c=a.useKibana,u=(e,t,r)=>{const{Provider:s}=(0,i.useMemo)((()=>o(e,t,r)),[e,r,t]);return s},d=e=>{const t=(0,i.useMemo)((()=>({kibanaVersion:null==e?void 0:e.kibanaVersion,isCloudEnv:null==e?void 0:e.isCloudEnv,isServerlessEnv:null==e?void 0:e.isServerlessEnv})),[e]);return({kibanaEnv:e={},children:r})=>(0,i.createElement)(l.Provider,{value:{...e,...t},children:r})};function p(){return(0,i.useContext)(l)}const g=(e,t)=>s().lazy((()=>Promise.all([t(),e.getStartServices()]).then((([{default:e},[t,r,i]])=>{const{Provider:s}=o(t,r,i);return{default:t=>(0,n.jsx)(s,null,(0,n.jsx)(e,t))}}))))},30769:(e,t,r)=>{"use strict";r.r(t),r.d(t,{plugin:()=>de});var i=r(68915),s=r(64390),a=r(75008),n=r(33838),o=r(73780),l=r(80190);const c=e=>"function"==typeof(null==e?void 0:e.addNewPanel);r(4513),r(5919);var u=r(84839),d=r(67546),p=r(68597),g=r(16438),h=r(84286),m=r.n(h),f=r(4332),_=r(48786);function b({criteria:e,filterQuery:t}){const r={errors:{}},i={};return r.errors=i,t===f.H2&&(i.filterQuery=[a.i18n.translate("xpack.infra.metrics.alertFlyout.error.invalidFilterQuery",{defaultMessage:"Filter query is invalid."})]),e&&e.length?(e.forEach(((e,t)=>{var r;const s=t.toString();i[s]=i[s]||{timeSizeUnit:[],timeWindowSize:[],critical:{threshold0:[],threshold1:[]},warning:{threshold0:[],threshold1:[]},metric:[]},e.threshold&&e.threshold.length||i[s].critical.threshold0.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."})),e.warningThreshold&&!e.warningThreshold.length&&i[s].warning.threshold0.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}));for(const t of[{comparator:e.comparator,threshold:e.threshold,type:"critical"},{comparator:e.warningComparator,threshold:e.warningThreshold,type:"warning"}]){const{comparator:e,threshold:r,type:n}=t;r&&r.length&&![...r].every(y)&&[...r].forEach(((e,t)=>{if(!y(e)){const e=0===t?"threshold0":"threshold1";i[s][n][e].push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdTypeRequired",{defaultMessage:"Thresholds must contain a valid number."}))}})),e===_.o.BETWEEN&&(!r||r.length<2)&&i[s][n].threshold1.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}))}e.timeSize||i[s].timeWindowSize.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.timeRequred",{defaultMessage:"Time size is Required."})),e.metric||i[s].metric.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.metricRequired",{defaultMessage:"Metric is required."})),"custom"!==e.metric||null!==(r=e.customMetric)&&void 0!==r&&r.field||i[s].metric.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetricFieldRequired",{defaultMessage:"Field is required."}))})),r):r}const y=e=>"number"==typeof e;var v=r(69219),T=r(51783),E=r.n(T),S=r(45995),O=r(61474),A=r(30770),x=r(22787);const k=`${v.ZQ}.criteria.metric`,D=`${v.ZQ}.nodeType`,w="custom",M=(e,t="")=>Object.entries(e).reduce(((e,[r,i])=>{const s=t.length?`${t}.${r}`:r;return"object"==typeof i&&null!=i?Array.isArray(i)&&i.length>0?Object.assign(e,M(i[0],s)):Object.assign(e,M(i,s)):(e[s]=Array.isArray(i)?i:[i],e)}),{}),R=({fields:e,assetDetailsLocator:t,inventoryLocator:r})=>{if(!t||!r)throw new Error("Locators for Asset Details and Inventory are required");const i=e[v.ZQ]?{...e,...M(e[v.ZQ],v.ZQ)}:e,s=(0,A.castArray)(i[D])[0];if(!s)return"";const a=i[(0,O.findInventoryModel)(s).fields.id],n=Object.values(o.SupportedAssetTypes).includes(s),l=i[k][0];if(a&&n)return L({assetId:a,assetType:s,timestamp:i[v.ht],alertMetric:l,assetDetailsLocator:t});const c={nodeType:s,timestamp:Date.parse(i[v.ht]),customMetric:"",metric:""};if(l===w){const e=i[`${v.ZQ}.criteria.customMetric.id`][0],t=i[`${v.ZQ}.criteria.customMetric.aggregation`][0],r=i[`${v.ZQ}.criteria.customMetric.field`][0],s=(0,S.encode)({id:e,type:w,field:r,aggregation:t});c.customMetric=s,c.metric=s}else c.metric=(0,S.encode)({type:l});return r.getRedirectUrl({...c})};function L({assetId:e,assetType:t,timestamp:r,alertMetric:i,assetDetailsLocator:s}){return s.getRedirectUrl({assetId:e,assetType:t,assetDetails:{dateRange:{from:r,to:E()(r).add(x.KN,"ms").toISOString()},...i&&i!==w?{alertMetric:i}:void 0}})}const C=a.i18n.translate("xpack.infra.metrics.alerting.inventory.threshold.defaultActionMessage",{defaultMessage:"'{{context.reason}}'\n\n'{{rule.name}}' is active with the following conditions:\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Observed value: '{{context.value}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),I=a.i18n.translate("xpack.infra.metrics.alerting.inventory.threshold.defaultRecoveryMessage",{defaultMessage:"'{{rule.name}}' has recovered.\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"});var P=r(92105),j=r(55964);const F=/[^A-Z|+|\-|\s|\d+|\.|\(|\)|\/|\*|>|<|=|\?|\:|&|\!|\|]+/g;function U({criteria:e,filterQuery:t}){const r={errors:{}},i={};return r.errors=i,t===f.H2&&(i.filterQuery=[a.i18n.translate("xpack.infra.metrics.alertFlyout.error.invalidFilterQuery",{defaultMessage:"Filter query is invalid."})]),e&&e.length?(e.forEach(((e,t)=>{const r=t.toString();i[r]=i[r]||{aggField:[],timeSizeUnit:[],timeWindowSize:[],critical:{threshold0:[],threshold1:[]},warning:{threshold0:[],threshold1:[]},metric:[],filterQuery:[],customMetrics:{}},e.aggType||i[r].aggField.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.aggregationRequired",{defaultMessage:"Aggregation is required."})),e.threshold&&e.threshold.length||i[r].critical.threshold0.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."})),e.warningThreshold&&!e.warningThreshold.length&&i[r].warning.threshold0.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}));for(const t of[{comparator:e.comparator,threshold:e.threshold,type:"critical"},{comparator:e.warningComparator,threshold:e.warningThreshold,type:"warning"}]){const{comparator:e,threshold:s,type:n}=t;s&&s.length&&![...s].every(V)&&[...s].forEach(((e,t)=>{if(!V(e)){const e=0===t?"threshold0":"threshold1";i[r][n][e].push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdTypeRequired",{defaultMessage:"Thresholds must contain a valid number."}))}})),e===_.o.BETWEEN&&(!s||s.length<2)&&i[r][n].threshold1.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}))}e.timeSize||i[r].timeWindowSize.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.timeRequred",{defaultMessage:"Time size is Required."})),"count"===e.aggType||"custom"===e.aggType||e.metric||i[r].metric.push(a.i18n.translate("xpack.infra.metrics.alertFlyout.error.metricRequired",{defaultMessage:"Metric is required."})),e.aggType===f.J2.CUSTOM&&(!e.customMetrics||e.customMetrics&&e.customMetrics.length<1?i[r].customMetricsError=a.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetricsError",{defaultMessage:"You must define at least 1 custom metric"}):e.customMetrics.forEach((e=>{const t={};if(e.aggType||(t.aggType=a.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetrics.aggTypeRequired",{defaultMessage:"Aggregation is required"})),"count"===e.aggType||e.field||(t.field=a.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetrics.fieldRequired",{defaultMessage:"Field is required"})),"count"===e.aggType&&e.filter)try{(0,j.fromKueryExpression)(e.filter)}catch(e){t.filter=e.message}(0,A.isEmpty)(t)||(i[r].customMetrics[e.name]=t)})),e.equation&&e.equation.match(F)&&(i[r].equation=a.i18n.translate("xpack.infra.metrics.alertFlyout.error.equation.invalidCharacters",{defaultMessage:"The equation field only supports the following characters: A-Z, +, -, /, *, (, ), ?, !, &, :, |, >, <, ="})))})),r):r}const V=e=>"number"==typeof e,$=({assetDetailsLocator:e,metricsExplorerLocator:t})=>({fields:r})=>{var i;const s=null!==(i=r[v.at])&&void 0!==i?i:"-",a=r[v.ZQ],n=(({fields:e,groupBy:t,assetDetailsLocator:r,metricsExplorerLocator:i})=>{if(!r||!i)throw new Error("Locators for Asset Details and Metrics Explorer are required");if(!t)return i.getRedirectUrl({});const s=Object.values(o.SupportedAssetTypes).reduce(((e,t)=>(e[(0,O.findInventoryModel)(t).fields.id]=t,e)),{}),a=t.find((e=>!!s[e])),n=a?s[a]:void 0;if(n){const t=e[(0,O.findInventoryModel)(n).fields.id];return t?L({assetId:t,assetType:n,timestamp:e[v.ht],assetDetailsLocator:r}):i.getRedirectUrl({})}return i.getRedirectUrl({})})({fields:r,groupBy:(0,A.castArray)(null==a?void 0:a.groupBy),assetDetailsLocator:e,metricsExplorerLocator:t});return{reason:s,link:n,hasBasePath:!0}},H=a.i18n.translate("xpack.infra.metrics.alerting.metric.threshold.defaultActionMessage",{defaultMessage:"'{{context.reason}}'\n\n'{{rule.name}}' is active with the following conditions:\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Observed value: '{{context.value}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),q=a.i18n.translate("xpack.infra.metrics.alerting.metric.threshold.defaultRecoveryMessage",{defaultMessage:"'{{rule.name}}' has recovered.\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"});var N=r(45266);const B=e=>async()=>{const[t]=await e(),{http:r}=t,i=await r.get("/api/metrics/source/default/hasData");return{hasData:i.hasData,indices:i.configuration.metricAlias}},Q=e=>async({absoluteTime:t,intervalString:r})=>{const[i]=await e(),{http:s}=i,a=async(e={})=>{const{start:i,end:n}=t,o={sourceId:"default",bucketSize:r,size:5,timerange:{from:i,to:n},...e};return{appLink:`/app/metrics/inventory?waffleTime=(currentTime:${n},isAutoReloading:!f)`,series:(await s.post("/api/metrics/overview/top",{body:JSON.stringify(o)})).series,sort:async(e,t)=>a({sort:e,sortDirection:t})}};return await a()};class InventoryViewsService{constructor(){(0,i.default)(this,"client",void 0)}setup(){return{}}start({http:e}){return{getClient:()=>this.getClient({http:e})}}async getClient({http:e}){if(!this.client){const{InventoryViewsClient:t}=await Promise.all([r.e(94),r.e(133),r.e(108)]).then(r.bind(r,15108)),i=new t(e);this.client=i}return this.client}}class MetricsExplorerViewsService{constructor(){(0,i.default)(this,"client",void 0)}setup(){return{}}start({http:e}){return{getClient:()=>this.getClient({http:e})}}async getClient({http:e}){if(!this.client){const{MetricsExplorerViewsClient:t}=await Promise.all([r.e(94),r.e(133),r.e(502)]).then(r.bind(r,15502)),i=new t(e);this.client=i}return this.client}}var K=r(21192);let W=function(e){return e.HOSTS_VIEW_QUERY_SUBMITTED="Hosts View Query Submitted",e.HOSTS_ENTRY_CLICKED="Host Entry Clicked",e.HOST_FLYOUT_FILTER_REMOVED="Host Flyout Filter Removed",e.HOST_FLYOUT_FILTER_ADDED="Host Flyout Filter Added",e.HOST_VIEW_TOTAL_HOST_COUNT_RETRIEVED="Host View Total Host Count Retrieved",e.ASSET_DETAILS_FLYOUT_VIEWED="Asset Details Flyout Viewed",e.ASSET_DETAILS_PAGE_VIEWED="Asset Details Page Viewed",e.ASSET_DASHBOARD_LOADED="Asset Dashboard Loaded",e.ADD_METRICS_CALLOUT_ADD_METRICS_CLICKED="Add Metrics Callout Add Metrics Clicked",e.ADD_METRICS_CALLOUT_TRY_IT_CLICKED="Add Metrics Callout Try It Clicked",e.ADD_METRICS_CALLOUT_LEARN_MORE_CLICKED="Add Metrics Callout Learn More Clicked",e.ADD_METRICS_CALLOUT_DISMISSED="Add Metrics Callout Dismissed",e}({});class TelemetryClient{constructor(e){(0,i.default)(this,"reportHostEntryClicked",(({hostname:e,cloud_provider:t})=>{this.analytics.reportEvent(W.HOSTS_ENTRY_CLICKED,{hostname:e,cloud_provider:null!=t?t:"unknown"})})),(0,i.default)(this,"reportHostFlyoutFilterRemoved",(({field_name:e})=>{this.analytics.reportEvent(W.HOST_FLYOUT_FILTER_REMOVED,{field_name:e})})),(0,i.default)(this,"reportHostFlyoutFilterAdded",(({field_name:e})=>{this.analytics.reportEvent(W.HOST_FLYOUT_FILTER_ADDED,{field_name:e})})),(0,i.default)(this,"reportHostsViewQuerySubmitted",(e=>{this.analytics.reportEvent(W.HOSTS_VIEW_QUERY_SUBMITTED,e)})),(0,i.default)(this,"reportAssetDetailsFlyoutViewed",(e=>{this.analytics.reportEvent(W.ASSET_DETAILS_FLYOUT_VIEWED,e)})),(0,i.default)(this,"reportAssetDetailsPageViewed",(e=>{this.analytics.reportEvent(W.ASSET_DETAILS_PAGE_VIEWED,e)})),(0,i.default)(this,"reportAssetDashboardLoaded",(e=>{this.analytics.reportEvent(W.ASSET_DASHBOARD_LOADED,e)})),(0,i.default)(this,"reportPerformanceMetricEvent",((e,t,r={},i={})=>{(0,K.reportPerformanceMetricEvent)(this.analytics,{eventName:e,duration:t,meta:i,...r})})),(0,i.default)(this,"reportAddMetricsCalloutAddMetricsClicked",(e=>{this.analytics.reportEvent(W.ADD_METRICS_CALLOUT_ADD_METRICS_CLICKED,e)})),(0,i.default)(this,"reportAddMetricsCalloutTryItClicked",(e=>{this.analytics.reportEvent(W.ADD_METRICS_CALLOUT_TRY_IT_CLICKED,e)})),(0,i.default)(this,"reportAddMetricsCalloutLearnMoreClicked",(e=>{this.analytics.reportEvent(W.ADD_METRICS_CALLOUT_LEARN_MORE_CLICKED,e)})),(0,i.default)(this,"reportAddMetricsCalloutDismissed",(e=>{this.analytics.reportEvent(W.ADD_METRICS_CALLOUT_DISMISSED,e)})),this.analytics=e}reportHostsViewTotalHostCountRetrieved(e){this.analytics.reportEvent(W.HOST_VIEW_TOTAL_HOST_COUNT_RETRIEVED,e)}}const z={eventType:W.HOSTS_VIEW_QUERY_SUBMITTED,schema:{control_filter_fields:{type:"array",items:{type:"text",_meta:{description:"Selected host control filter.",optional:!1}}},filter_fields:{type:"array",items:{type:"text",_meta:{description:"Applied host search filter.",optional:!1}}},interval:{type:"text",_meta:{description:"Time interval for the performed search.",optional:!1}},with_query:{type:"boolean",_meta:{description:"KQL query search for hosts",optional:!1}},limit:{type:"integer",_meta:{description:"Selected host limit",optional:!1}}}},Y={eventType:W.HOSTS_ENTRY_CLICKED,schema:{hostname:{type:"keyword",_meta:{description:"Hostname for the clicked host.",optional:!1}},cloud_provider:{type:"keyword",_meta:{description:"Cloud provider for the clicked host.",optional:!0}}}},G={eventType:W.HOST_FLYOUT_FILTER_REMOVED,schema:{field_name:{type:"keyword",_meta:{description:"Removed filter field name for the selected host.",optional:!1}}}},Z={eventType:W.HOST_FLYOUT_FILTER_ADDED,schema:{field_name:{type:"keyword",_meta:{description:"Added filter field name for the selected host.",optional:!1}}}},J={eventType:W.HOST_VIEW_TOTAL_HOST_COUNT_RETRIEVED,schema:{total:{type:"integer",_meta:{description:"Total number of hosts retrieved.",optional:!1}},with_query:{type:"boolean",_meta:{description:"Has KQL query",optional:!1}},with_filters:{type:"boolean",_meta:{description:"Has filters",optional:!1}}}},X=[{eventType:W.ASSET_DETAILS_FLYOUT_VIEWED,schema:{componentName:{type:"keyword",_meta:{description:"Name of the parent react component for the clicked asset.",optional:!1}},assetType:{type:"keyword",_meta:{description:"Asset type for the clicked asset.",optional:!1}},tabId:{type:"keyword",_meta:{description:"Tab id for the clicked asset.",optional:!0}}}},{eventType:W.ASSET_DETAILS_PAGE_VIEWED,schema:{componentName:{type:"keyword",_meta:{description:"Name of the parent react component for the clicked asset.",optional:!1}},assetType:{type:"keyword",_meta:{description:"Asset type for the clicked asset.",optional:!1}},tabId:{type:"keyword",_meta:{description:"Tab id for the clicked asset.",optional:!0}},integrations:{type:"pass_through",_meta:{description:"Integrations enabled for the displayed asset.",optional:!0}}}},z,Y,G,Z,J,{eventType:W.ASSET_DASHBOARD_LOADED,schema:{assetType:{type:"keyword",_meta:{description:"Asset type for the selected asset.",optional:!1}},state:{type:"boolean",_meta:{description:"If the dashboard is filtered or now",optional:!1}},filtered_by:{type:"array",items:{type:"text",_meta:{description:"Filters enabled for the dashboard added for an asset"}}}}},{eventType:W.ADD_METRICS_CALLOUT_ADD_METRICS_CLICKED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}},{eventType:W.ADD_METRICS_CALLOUT_TRY_IT_CLICKED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}},{eventType:W.ADD_METRICS_CALLOUT_LEARN_MORE_CLICKED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}},{eventType:W.ADD_METRICS_CALLOUT_DISMISSED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}}];class TelemetryService{constructor(e=null){this.analytics=e}setup({analytics:e}){this.analytics=e,X.forEach((t=>e.registerEventType(t)))}start(){if(!this.analytics)throw new Error("The TelemetryService.setup() method has not been invoked, be sure to call it during the plugin setup.");return new TelemetryClient(this.analytics)}}var ee=r(66764);function te(e){return async t=>{const[,{data:r,logsShared:i,share:s}]=await e(),a=await i.logViews.client.getResolvedLogView(ee.DEFAULT_LOG_VIEW),{stats:n,series:o}=await async function(e,t,r){return new Promise(((i,s)=>{let a;r.search.search({params:{index:e.index,body:{size:0,query:re(0,t),aggs:ie(0,t)}}}).subscribe((e=>a=e.rawResponse),(e=>s(e)),(()=>{var e;null!==(e=a)&&void 0!==e&&e.aggregations?i(function(e){const t={},r={};return e.stats.buckets.forEach((e=>{const i=e.key;t[e.key]={type:"number",label:i,value:e.doc_count},e.series.buckets.forEach((e=>{r[i]=r[i]||{label:i,coordinates:[]},r[i].coordinates.push({x:e.key,y:e.doc_count})}))})),{stats:t,series:r}}(a.aggregations)):i({stats:{},series:{}})}))}))}({index:a.indices},t,r),{logsLocator:l}=(0,ee.getLogsLocatorsFromUrlService)(s.url),c=(t.absoluteTime.end-t.absoluteTime.start)/6e4;return{appLink:l.getRedirectUrl({timeRange:{startTime:t.absoluteTime.start,endTime:t.absoluteTime.end}}),stats:se(n,c),series:ae(o)}}}function re(e,t){return{range:{[x.WK]:{gt:new Date(t.absoluteTime.start).toISOString(),lte:new Date(t.absoluteTime.end).toISOString(),format:"strict_date_optional_time"}}}}function ie(e,t){return{stats:{terms:{field:"event.dataset",size:4,missing:"unknown"},aggs:{series:{date_histogram:{field:x.WK,fixed_interval:t.intervalString}}}}}}function se(e,t){return Object.keys(e).reduce(((r,i)=>(r[i]={...e[i],value:e[i].value/t},r)),{})}function ae(e){const t=Object.keys(e),r=t.flatMap((t=>e[t].coordinates.map((e=>e.x)))),[i,s]=[...new Set(r)].sort(),a=(s-i)/6e4;return t.reduce(((t,r)=>(t[r]={...e[r],coordinates:e[r].coordinates.map((e=>e.y?{...e,y:e.y/a}:e))},t)),{})}var ne=r(17808),oe=r(86899);class Plugin{constructor(e){(0,i.default)(this,"config",void 0),(0,i.default)(this,"inventoryViews",void 0),(0,i.default)(this,"metricsExplorerViews",void 0),(0,i.default)(this,"telemetry",void 0),(0,i.default)(this,"kibanaVersion",void 0),(0,i.default)(this,"isServerlessEnv",void 0),(0,i.default)(this,"appUpdater$",new l.BehaviorSubject((()=>({})))),this.config=e.config.get(),this.inventoryViews=new InventoryViewsService,this.metricsExplorerViews=this.config.featureFlags.metricsExplorerEnabled?new MetricsExplorerViewsService:void 0,this.telemetry=new TelemetryService,this.kibanaVersion=e.env.packageInfo.version,this.isServerlessEnv="serverless"===e.env.packageInfo.buildFlavor}setup(e,t){var i,c,u;const d=e.uiSettings.get(p.Zh,!1);var g;t.home&&((g=t.home).featureCatalogue.register({id:"metrics",title:a.i18n.translate("xpack.infra.registerFeatures.infraOpsTitle",{defaultMessage:"Metrics"}),description:a.i18n.translate("xpack.infra.registerFeatures.infraOpsDescription",{defaultMessage:"Explore infrastructure metrics and logs for common servers, containers, and services."}),icon:"metricsApp",path:"/app/metrics",showOnHomePage:!1,category:"data"}),g.featureCatalogue.register({id:"observability-logs-explorer",title:a.i18n.translate("xpack.infra.registerFeatures.logsTitle",{defaultMessage:"Logs"}),description:a.i18n.translate("xpack.infra.registerFeatures.logsDescription",{defaultMessage:"Stream logs in real time or scroll through historical views in a console-like experience."}),icon:"logsApp",path:"/app/observability-logs-explorer",showOnHomePage:!1,category:"data"}));const _=t.share.url.locators.get(o.ASSET_DETAILS_LOCATOR_ID),y=t.share.url.locators.get(o.INVENTORY_LOCATOR_ID),T=t.share.url.locators.get(o.METRICS_EXPLORER_LOCATOR_ID);var E;t.observability.observabilityRuleTypeRegistry.register(function({assetDetailsLocator:e,inventoryLocator:t}){const i=(({assetDetailsLocator:e,inventoryLocator:t})=>({fields:r})=>{var i;return{reason:null!==(i=r[v.at])&&void 0!==i?i:"-",link:R({fields:r,assetDetailsLocator:e,inventoryLocator:t}),hasBasePath:!0}})({assetDetailsLocator:e,inventoryLocator:t});return{id:f.Yj,description:a.i18n.translate("xpack.infra.metrics.inventory.alertFlyout.alertDescription",{defaultMessage:"Alert when the inventory exceeds a defined threshold."}),iconClass:"bell",documentationUrl:e=>`${e.links.observability.infrastructureThreshold}`,ruleParamsExpression:m().lazy((()=>Promise.all([r.e(94),r.e(133),r.e(65),r.e(505),r.e(952),r.e(190)]).then(r.bind(r,11729)))),validate:b,defaultActionMessage:C,defaultRecoveryMessage:I,requiresAppContext:!1,format:i,priority:20}}({assetDetailsLocator:_,inventoryLocator:y})),t.observability.observabilityRuleTypeRegistry.register(function({assetDetailsLocator:e,metricsExplorerLocator:t}){return{id:f.lN,description:a.i18n.translate("xpack.infra.metrics.alertFlyout.alertDescription",{defaultMessage:"Alert when the metrics aggregation exceeds the threshold."}),iconClass:"bell",documentationUrl:e=>`${e.links.observability.metricsThreshold}`,ruleParamsExpression:(0,h.lazy)((()=>Promise.all([r.e(94),r.e(133),r.e(505),r.e(974)]).then(r.bind(r,60974)))),validate:U,defaultActionMessage:H,defaultRecoveryMessage:q,requiresAppContext:!1,format:$({assetDetailsLocator:e,metricsExplorerLocator:t}),alertDetailsAppSection:(0,h.lazy)((()=>Promise.all([r.e(505),r.e(249)]).then(r.bind(r,6249)))),priority:10}}({assetDetailsLocator:_,metricsExplorerLocator:T})),this.config.featureFlags.logsUIEnabled&&t.observability.dashboard.register({appName:"infra_logs",hasData:(E=e.getStartServices,async()=>{const[,{logsShared:e}]=await E(),t=await e.logViews.client.getResolvedLogView(ee.DEFAULT_LOG_VIEW);return{hasData:"available"===(await e.logViews.client.getResolvedLogViewStatus(t)).index,indices:t.indices}}),fetchData:te(e.getStartServices)}),t.observability.dashboard.register({appName:"infra_metrics",hasData:B(e.getStartServices),fetchData:Q(e.getStartServices)}),t.logsShared.logViews.setLogViewsStaticConfig({messageFields:null===(i=this.config.sources)||void 0===i||null===(c=i.default)||void 0===c||null===(u=c.fields)||void 0===u?void 0:u.message});const S=(0,l.combineLatest)([(0,l.from)(e.getStartServices()),e.settings.client.get$(n.enableInfrastructureHostsView)]).pipe((0,l.switchMap)((([[{application:e}],t])=>(0,l.combineLatest)([(0,l.of)(e),(0,l.of)(t),ce(e)])))),O=(0,oe.V)({isLogsStreamEnabled:d});t.observabilityShared.navigation.registerSections(S.pipe((0,l.map)((([e,t,r])=>{const{infrastructure:i,logs:s}=e.capabilities;return[...s.show?[{label:ne.U7,sortKey:200,entries:le({isLogsExplorerAccessible:r,config:this.config,routes:O})}]:[],...i.show?[{label:ne.c1,sortKey:300,entries:[{label:ne.dd,app:"metrics",path:"/inventory"},...this.config.featureFlags.metricsExplorerEnabled?[{label:ne.jv,app:"metrics",path:"/explorer"}]:[],...t?[{label:ne.S$,app:"metrics",path:"/hosts"}]:[]]}]:[]]})))),t.embeddable.registerReactEmbeddableFactory(N.i,(async()=>{const{getLogStreamEmbeddableFactory:t}=await Promise.all([r.e(94),r.e(544)]).then(r.bind(r,10544)),[i,s,a]=await e.getStartServices();return t({coreStart:i,pluginDeps:s,pluginStart:a})})),t.observability.observabilityRuleTypeRegistry.register((0,P.Y)(e,t.share.url)),this.config.featureFlags.logsUIEnabled&&e.application.register({id:"logs",title:a.i18n.translate("xpack.infra.logs.pluginTitle",{defaultMessage:"Logs"}),euiIconType:"logoObservability",order:8100,appRoute:"/app/logs",deepLinks:Object.values(O),category:s.DEFAULT_APP_CATEGORIES.observability,mount:async t=>{const[i,s,a]=await e.getStartServices(),n=await(0,l.firstValueFrom)(ce(i.application)),{renderApp:o}=await Promise.all([r.e(94),r.e(133),r.e(440),r.e(21)]).then(r.bind(r,8697));return o(i,s,a,n,t)}});const A=({hostsEnabled:e,metricsExplorerEnabled:t})=>{const r=["globalSearch"];return[{id:"inventory",title:ne.dd,path:"/inventory",visibleIn:r},...e?[{id:"hosts",title:a.i18n.translate("xpack.infra.homePage.metricsHostsTabTitle",{defaultMessage:"Hosts"}),path:"/hosts",visibleIn:r}]:[],...t?[{id:"metrics-explorer",title:a.i18n.translate("xpack.infra.homePage.metricsExplorerTabTitle",{defaultMessage:"Metrics Explorer"}),path:"/explorer"}]:[],{id:"settings",title:a.i18n.translate("xpack.infra.homePage.settingsTabTitle",{defaultMessage:"Settings"}),path:"/settings"},{id:"assetDetails",title:"",path:"/detail",visibleIn:[]}]};return e.application.register({id:"metrics",title:a.i18n.translate("xpack.infra.metrics.pluginTitle",{defaultMessage:"Infrastructure"}),euiIconType:"logoObservability",order:8200,appRoute:"/app/metrics",category:s.DEFAULT_APP_CATEGORIES.observability,updater$:this.appUpdater$,deepLinks:A({hostsEnabled:e.settings.client.get(n.enableInfrastructureHostsView),metricsExplorerEnabled:this.config.featureFlags.metricsExplorerEnabled}),mount:async i=>{var s,a;const[n,o,l]=await e.getStartServices(),{renderApp:c}=await Promise.all([r.e(94),r.e(133),r.e(505),r.e(940),r.e(440),r.e(599)]).then(r.bind(r,53599)),u=!(null===(s=t.cloud)||void 0===s||!s.isCloudEnabled),d=(null===(a=t.cloud)||void 0===a?void 0:a.isServerlessEnabled)||this.isServerlessEnv;return c(n,{...o,licenseManagement:t.licenseManagement},l,this.config,i,{kibanaVersion:this.kibanaVersion,isCloudEnv:u,isServerlessEnv:d})}}),S.subscribe((([e,t,r])=>{this.appUpdater$.next((()=>({deepLinks:A({hostsEnabled:t,metricsExplorerEnabled:this.config.featureFlags.metricsExplorerEnabled})})))})),this.telemetry.setup({analytics:e.analytics}),{}}start(e,t){var r;const{http:i,uiSettings:s}=e,n=s.get(p.Zh,!1),o=this.inventoryViews.start({http:i}),l=null===(r=this.metricsExplorerViews)||void 0===r?void 0:r.start({http:i}),g=this.telemetry.start();return n&&(t.uiActions.registerAction({id:N.L,grouping:[d.ADD_PANEL_LEGACY_GROUP],order:30,getDisplayName:()=>a.i18n.translate("xpack.infra.logStreamEmbeddable.displayName",{defaultMessage:"Log stream (deprecated)"}),getDisplayNameTooltip:()=>a.i18n.translate("xpack.infra.logStreamEmbeddable.description",{defaultMessage:"Add a table of live streaming logs. For a more efficient experience, we recommend using the Discover Page to create a saved Discover session instead of using Log stream."}),getIconType:()=>"logsApp",isCompatible:async({embeddable:e})=>c(e),execute:async({embeddable:e})=>{if(!c(e))throw new u.IncompatibleActionError;e.addNewPanel({panelType:N.i,initialState:{title:a.i18n.translate("xpack.infra.logStreamEmbeddable.title",{defaultMessage:"Log stream"})}},!0)}}),t.uiActions.attachAction(u.ADD_PANEL_TRIGGER,N.L)),{inventoryViews:o,metricsExplorerViews:l,telemetry:g}}stop(){}}const le=({isLogsExplorerAccessible:e,config:t,routes:r})=>{const i=[];return t.featureFlags.logsUIEnabled?(e&&i.push({label:"Explorer",app:"observability-logs-explorer",path:"/",isBetaFeature:!0}),r.stream&&i.push(ue(r.stream)),i.push(ue(r.logsAnomalies)),i.push(ue(r.logsCategories)),r.stream||i.push(ue(r.settings)),i):i},ce=e=>{const{applications$:t}=e;return t.pipe((0,l.map)((e=>{var t,r;return(null!==(t=null===(r=e.get(g.kY))||void 0===r?void 0:r.status)&&void 0!==t?t:s.AppStatus.inaccessible)===s.AppStatus.accessible})),(0,l.distinctUntilChanged)())},ue=({path:e,title:t})=>({app:"logs",label:t,path:e}),de=e=>new Plugin(e)},86899:(e,t,r)=>{"use strict";r.d(t,{V:()=>s});var i=r(17808);const s=({isLogsStreamEnabled:e})=>{const t={logsAnomalies:{id:"anomalies",title:i.$s,path:"/anomalies"},logsCategories:{id:"log-categories",title:i.LJ,path:"/log-categories"},settings:{id:"settings",title:i.uj,path:"/settings"}};return e&&(t.stream={id:"stream",title:i.DD,path:"/stream"}),t}},17808:(e,t,r)=>{"use strict";r.d(t,{$s:()=>o,DD:()=>n,JU:()=>h,LJ:()=>l,S$:()=>g,U7:()=>a,c1:()=>u,dd:()=>d,jv:()=>p,m_:()=>s,uj:()=>c});var i=r(75008);const s=i.i18n.translate("xpack.infra.header.observabilityTitle",{defaultMessage:"Observability"}),a=i.i18n.translate("xpack.infra.header.logsTitle",{defaultMessage:"Logs"}),n=i.i18n.translate("xpack.infra.logs.index.streamTabTitle",{defaultMessage:"Stream"}),o=i.i18n.translate("xpack.infra.logs.index.anomaliesTabTitle",{defaultMessage:"Logs Anomalies"}),l=i.i18n.translate("xpack.infra.logs.index.logCategoriesBetaBadgeTitle",{defaultMessage:"Logs Categories"}),c=i.i18n.translate("xpack.infra.logs.index.settingsTabTitle",{defaultMessage:"Settings"}),u=i.i18n.translate("xpack.infra.header.infrastructureTitle",{defaultMessage:"Infrastructure"}),d=i.i18n.translate("xpack.infra.metrics.infrastructureInventoryTitle",{defaultMessage:"Infrastructure inventory"}),p=i.i18n.translate("xpack.infra.metrics.metricsExplorerTitle",{defaultMessage:"Metrics Explorer"}),g=i.i18n.translate("xpack.infra.metrics.hostsTitle",{defaultMessage:"Hosts"}),h=i.i18n.translate("xpack.infra.metricDetailPage.documentTitleError",{defaultMessage:"Uh oh"})},4513:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var i,s,a;if(Array.isArray(t)){if((i=t.length)!=r.length)return!1;for(s=i;0!=s--;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((i=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(s=i;0!=s--;)if(!Object.prototype.hasOwnProperty.call(r,a[s]))return!1;for(s=i;0!=s--;){var n=a[s];if(!e(t[n],r[n]))return!1}return!0}return t!=t&&r!=r}},69209:(e,t,r)=>{r.p=window.__kbnPublicPath__.infra},40511:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/aiops/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},95240:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/charts/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},82677:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/controls/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},64390:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("entry/core/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},73961:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/dashboard/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},7195:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/data/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},14627:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},1050:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/discover/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},67546:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},52137:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/kibanaReact/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},20409:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},21359:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},61215:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},42298:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/licenseManagement/common/constants");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},69414:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/logsDataAccess/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},66764:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/logsShared/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},71952:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/logsShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},61474:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/metricsDataAccess/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},35902:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/metricsDataAccess/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},60636:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/ml/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},25170:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/observability/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},33838:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/observability/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},73780:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/observabilityShared/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},16808:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/observabilityShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},13073:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/triggersActionsUi/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},84839:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},11684:(e,t,r)=>{r.r(t);var i=__kbnBundles__.get("plugin/unifiedSearch/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},68915:(e,t,r)=>{e.exports=r(52497)(67493)},65927:e=>{"use strict";e.exports=__kbnSharedDeps__.Classnames},43059:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticCharts},81319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},26752:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticNumeral},96791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},43782:e=>{"use strict";e.exports=__kbnSharedDeps__.IoTs},9424:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnCodeEditor},76494:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnDatemath},21192:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEbtTools},55964:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsQuery},91991:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsqlAst},75008:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},75879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},30911:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnMonaco},20482:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaContextRender},45995:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnRison},11728:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnSharedUxErrorBoundary},30193:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnSharedUxRouter},53803:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnUiTheme},30770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},81060:e=>{"use strict";e.exports=__kbnSharedDeps__.LodashFp},51783:e=>{"use strict";e.exports=__kbnSharedDeps__.Moment},62488:e=>{"use strict";e.exports=__kbnSharedDeps__.MomentTimezone},84286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},22874:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactDom},13530:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactQuery},45692:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactQueryDevtools},1493:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactRouterDom},80190:e=>{"use strict";e.exports=__kbnSharedDeps__.Rxjs},95079:e=>{"use strict";e.exports=__kbnSharedDeps__.SaferLodashSet},1941:e=>{"use strict";e.exports=__kbnSharedDeps__.TsLib},9472:e=>{"use strict";e.exports=__kbnSharedDeps__.Uuid},52497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},s={};function a(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={id:e,exports:{}};return i[e].call(r.exports,r,r.exports,a),r.exports}a.m=i,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"==typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"==typeof r.then)return r}var s=Object.create(null);a.r(s);var n={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&r;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>n[e]=()=>r[e]));return n.default=()=>r,a.d(s,n),s},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>"infra.chunk."+e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},a.l=(e,t,i,s)=>{if(r[e])r[e].push(t);else{var n,o;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==e){n=u;break}}n||(o=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,a.nc&&n.setAttribute("nonce",a.nc),n.src=e),r[e]=[t];var d=(t,i)=>{n.onerror=n.onload=null,clearTimeout(p);var s=r[e];if(delete r[e],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach((e=>e(i))),t)return t(i)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=d.bind(null,n.onerror),n.onload=d.bind(null,n.onload),o&&document.head.appendChild(n)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{a.b=document.baseURI||self.location.href;var e={895:0};a.f.j=(t,r)=>{var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var s=new Promise(((r,s)=>i=e[t]=[r,s]));r.push(i[2]=s);var n=a.p+a.u(t),o=new Error;a.l(n,(r=>{if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var s=r&&("load"===r.type?"missing":r.type),n=r&&r.target&&r.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+n+")",o.name="ChunkLoadError",o.type=s,o.request=n,i[1](o)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,s,[n,o,l]=r,c=0;if(n.some((t=>0!==e[t]))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);l&&l(a)}for(t&&t(r);c<n.length;c++)s=n[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.infra_bundle_jsonpfunction=self.infra_bundle_jsonpfunction||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),a.nc=void 0,a(69209),__kbnBundles__.define("plugin/infra/public",a,30769)})();