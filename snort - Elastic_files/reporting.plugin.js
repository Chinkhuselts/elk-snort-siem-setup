/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e,t={859:(e,t,r)=>{"use strict";r.d(t,{A1:()=>c,Cd:()=>i,Ez:()=>n,Pm:()=>l,Zw:()=>o,fW:()=>a,pY:()=>d,xU:()=>s});const a="xpack.reporting.jobCompletionNotifications",i="/app/reportingRedirect",o="__REPORTING_REDIRECT_LOCATOR_STORE_KEY__",s="/app/management/insightsAndAlerting/reporting",n="kibana-reporting";let l=function(e){return e.PENDING="pending",e.PROCESSING="processing",e.COMPLETED="completed",e.FAILED="failed",e.WARNINGS="completed_with_warnings",e}({});const c="reportJobListing",d="reportJobRow"},7023:(e,t,r)=>{"use strict";r.d(t,{zf:()=>VisualReportingSoftDisabledError});var a=r(8915),i=r(5008);class ReportingError extends Error{constructor(e){super(),this.details=e}get message(){const e="ReportingError";return this.details?`${e}(code: ${this.code}) "${this.details}"`:`${e}(code: ${this.code})`}toString(){return this.message}}class InvalidLayoutParametersError extends ReportingError{get code(){return InvalidLayoutParametersError.code}}(0,a.default)(InvalidLayoutParametersError,"code","invalid_layout_parameters_error");class DisallowedOutgoingUrl extends ReportingError{get code(){return DisallowedOutgoingUrl.code}}(0,a.default)(DisallowedOutgoingUrl,"code","disallowed_outgoing_url_error");class AuthenticationExpiredError extends ReportingError{get code(){return AuthenticationExpiredError.code}}(0,a.default)(AuthenticationExpiredError,"code","authentication_expired_error");class QueueTimeoutError extends ReportingError{get code(){return QueueTimeoutError.code}}(0,a.default)(QueueTimeoutError,"code","queue_timeout_error");class UnknownError extends ReportingError{get code(){return UnknownError.code}}(0,a.default)(UnknownError,"code","unknown_error");class PdfWorkerOutOfMemoryError extends ReportingError{get code(){return PdfWorkerOutOfMemoryError.code}humanFriendlyMessage(){return i.i18n.translate("reporting.common.pdfWorkerOutOfMemoryErrorMessage",{defaultMessage:"Can't generate a PDF due to insufficient memory. Try making a smaller PDF and retrying this report."})}}(0,a.default)(PdfWorkerOutOfMemoryError,"code","pdf_worker_out_of_memory_error");class BrowserCouldNotLaunchError extends ReportingError{get code(){return BrowserCouldNotLaunchError.code}humanFriendlyMessage(){return i.i18n.translate("reporting.common.browserCouldNotLaunchErrorMessage",{defaultMessage:"Can't generate screenshots because the browser did not launch. See the server logs for more information."})}}(0,a.default)(BrowserCouldNotLaunchError,"code","browser_could_not_launch_error");class BrowserUnexpectedlyClosedError extends ReportingError{get code(){return BrowserUnexpectedlyClosedError.code}}(0,a.default)(BrowserUnexpectedlyClosedError,"code","browser_unexpectedly_closed_error");class BrowserScreenshotError extends ReportingError{get code(){return BrowserScreenshotError.code}}(0,a.default)(BrowserScreenshotError,"code","browser_screenshot_error");class KibanaShuttingDownError extends ReportingError{get code(){return KibanaShuttingDownError.code}}(0,a.default)(KibanaShuttingDownError,"code","kibana_shutting_down_error");class VisualReportingSoftDisabledError extends ReportingError{get code(){return VisualReportingSoftDisabledError.code}humanFriendlyMessage(){return i.i18n.translate("reporting.common.cloud.insufficientSystemMemoryError",{defaultMessage:"Can't generate this report due to insufficient memory."})}}(0,a.default)(VisualReportingSoftDisabledError,"code","visual_reporting_soft_disabled_error")},6743:(e,t,r)=>{"use strict";r.d(t,{Ez:()=>a.Ez,lJ:()=>n,fW:()=>a.fW,Pm:()=>a.Pm,Ff:()=>c,xU:()=>a.xU,Cd:()=>a.Cd,Zw:()=>a.Zw,A1:()=>a.A1,pY:()=>a.pY,yc:()=>o,l6:()=>i});var a=r(859);r(7023),r(1783);const i=e=>"number"==typeof e?e:e.asMilliseconds();r(8915),r(770);const o=({basePath:e,appPath:t,spaceId:r})=>void 0===r||"default"===r.toLowerCase()?`${e}${t}`:`${e}/s/${r}${t}`,s="/internal/reporting",n={MIGRATE:{MIGRATE_ILM_POLICY:s+"/deprecations/migrate_ilm_policy",GET_ILM_POLICY_STATUS:s+"/ilm_policy_status"},DIAGNOSE:{BROWSER:s+"/diagnose/browser",SCREENSHOT:s+"/diagnose/screenshot"},JOBS:{COUNT:s+"/jobs/count",LIST:s+"/jobs/list",INFO_PREFIX:s+"/jobs/info",DELETE_PREFIX:s+"/jobs/delete",DOWNLOAD_PREFIX:s+"/jobs/download"},DOWNLOAD_CSV:s+"/generate/immediate/csv_searchsource",GENERATE_PREFIX:s+"/generate"},l="/api/reporting",c={GENERATE_PREFIX:l+"/generate",JOBS:{DOWNLOAD_PREFIX:l+"/jobs/download",DELETE_PREFIX:l+"/jobs/delete"}}},1485:(e,t,r)=>{"use strict";r.d(t,{wn:()=>a,tE:()=>o,By:()=>c,lV:()=>i,y:()=>s,ah:()=>l});const a="csv_searchsource",i="csv_searchsource",o="csv_v2",s="csv_v2";var n=r(6743);const l=(e,{scroll:t},r)=>(e.setField("size",(0,n.l6)(t.size)),e.setField("timeout",t.duration),e.setField("trackTotalHits",!0),r&&e.setField("pit",{id:r,keep_alive:t.duration}),{requestBody:e.getSearchRequestBody()}),c="generateCsvReport"},7519:(e,t,r)=>{"use strict";r.d(t,{cU:()=>i,dn:()=>a});const a="printable_pdf_v2",i="printablePdfV2"},8628:(e,t,r)=>{"use strict";r.d(t,{F:()=>a,Y:()=>i});const a="pngV2",i="PNGV2"},3107:(e,t,r)=>{"use strict";r.r(t),r.d(t,{InternalApiClientProvider:()=>_,Job:()=>Job,ReportingAPIClient:()=>ReportingAPIClient,checkLicense:()=>k.q,jobCompletionNotifications:()=>x,useCheckIlmPolicyStatus:()=>P,useInternalApiClient:()=>w,useKibana:()=>D});var a=r(8915),i=r(1783),o=r.n(i),s=r(4286),n=r.n(s),l=r(1319),c=r(5008),d=r(6743),u=r(1485),p=r(7519),g=r(8628),h=r(6791);u.wn,u.tE,p.dn,g.Y;const{COMPLETED:f,FAILED:m,PENDING:b,PROCESSING:v,WARNINGS:y}=d.Pm;class Job{constructor(e){var t,r,i,o,s,n;(0,a.default)(this,"payload",void 0),(0,a.default)(this,"id",void 0),(0,a.default)(this,"index",void 0),(0,a.default)(this,"objectType",void 0),(0,a.default)(this,"title",void 0),(0,a.default)(this,"isDeprecated",void 0),(0,a.default)(this,"spaceId",void 0),(0,a.default)(this,"browserTimezone",void 0),(0,a.default)(this,"layout",void 0),(0,a.default)(this,"pagingStrategy",void 0),(0,a.default)(this,"version",void 0),(0,a.default)(this,"jobtype",void 0),(0,a.default)(this,"created_by",void 0),(0,a.default)(this,"created_at",void 0),(0,a.default)(this,"started_at",void 0),(0,a.default)(this,"completed_at",void 0),(0,a.default)(this,"status",void 0),(0,a.default)(this,"attempts",void 0),(0,a.default)(this,"max_attempts",void 0),(0,a.default)(this,"timeout",void 0),(0,a.default)(this,"kibana_name",void 0),(0,a.default)(this,"kibana_id",void 0),(0,a.default)(this,"size",void 0),(0,a.default)(this,"content_type",void 0),(0,a.default)(this,"csv_contains_formulas",void 0),(0,a.default)(this,"max_size_reached",void 0),(0,a.default)(this,"metrics",void 0),(0,a.default)(this,"warnings",void 0),(0,a.default)(this,"error_code",void 0),(0,a.default)(this,"locatorParams",void 0),(0,a.default)(this,"queue_time_ms",void 0),(0,a.default)(this,"execution_time_ms",void 0),this.id=e.id,this.index=e.index,this.payload=e.payload,this.jobtype=e.jobtype,this.objectType=e.payload.objectType,this.title=e.payload.title,this.layout=e.payload.layout,this.pagingStrategy=e.payload.pagingStrategy,this.version=e.payload.version,this.created_by=e.created_by,this.created_at=e.created_at,this.started_at=e.started_at,this.completed_at=e.completed_at,this.status=e.status,this.attempts=e.attempts,this.max_attempts=e.max_attempts,this.timeout=e.timeout,this.kibana_name=e.kibana_name,this.kibana_id=e.kibana_id,this.browserTimezone=e.payload.browserTimezone,this.size=null===(t=e.output)||void 0===t?void 0:t.size,this.content_type=null===(r=e.output)||void 0===r?void 0:r.content_type,this.isDeprecated=e.payload.isDeprecated||!1,this.spaceId=e.payload.spaceId,this.csv_contains_formulas=null===(i=e.output)||void 0===i?void 0:i.csv_contains_formulas,this.max_size_reached=null===(o=e.output)||void 0===o?void 0:o.max_size_reached,this.warnings=null===(s=e.output)||void 0===s?void 0:s.warnings,this.error_code=null===(n=e.output)||void 0===n?void 0:n.error_code,this.locatorParams=e.payload.locatorParams,this.metrics=e.metrics,this.queue_time_ms=e.queue_time_ms,this.execution_time_ms=e.execution_time_ms}isSearch(){return"search"===this.objectType}getStatusMessage(){const e=this.status;let t,r;return e===b?t=c.i18n.translate("reporting.jobStatusDetail.pendingStatusReachedText",{defaultMessage:"Waiting for job to process."}):e===v?t=c.i18n.translate("reporting.jobStatusDetail.attemptXofY",{defaultMessage:"Attempt {attempts} of {max_attempts}.",values:{attempts:this.attempts,max_attempts:this.max_attempts}}):this.getWarnings()?t=c.i18n.translate("reporting.jobStatusDetail.warningsText",{defaultMessage:"See report info for warnings."}):this.getError()&&(t=c.i18n.translate("reporting.jobStatusDetail.errorText",{defaultMessage:"See report info for error details."})),this.isDeprecated&&(r=(0,h.jsx)(l.EuiText,{size:"s"}," ",(0,h.jsx)(l.EuiTextColor,{color:"warning"},c.i18n.translate("reporting.jobStatusDetail.deprecatedText",{defaultMessage:"This is a deprecated export type. Automation of this report will need to be re-created for compatibility with future versions of Kibana."})))),t?(0,h.jsx)(n().Fragment,null,(0,h.jsx)(l.EuiText,{size:"s"},(0,h.jsx)(l.EuiTextColor,{color:"subdued"},t)),r||null):null}get prettyStatus(){var e;return null!==(e=S.get(this.status))&&void 0!==e?e:c.i18n.translate("reporting.jobStatusDetail.unknownText",{defaultMessage:"Unknown"})}get canLinkToKibanaApp(){return Boolean(this.locatorParams)}get isDownloadReady(){return this.status===d.Pm.COMPLETED||this.status===d.Pm.WARNINGS}get prettyJobTypeName(){switch(this.jobtype){case"printable_pdf":case"printable_pdf_v2":return c.i18n.translate("reporting.jobType.pdfOutputName",{defaultMessage:"PDF"});case"PNG":case"PNGV2":return c.i18n.translate("reporting.jobType.pngOutputName",{defaultMessage:"PNG"});case"csv_v2":case"csv_searchsource":return c.i18n.translate("reporting.jobType.csvOutputName",{defaultMessage:"CSV"});default:return}}get prettyTimeout(){if(null==this.timeout)return c.i18n.translate("reporting.jobStatusDetail.timeoutSecondsUnknown",{defaultMessage:"Unknown"});const e=this.timeout/1e3;return c.i18n.translate("reporting.jobStatusDetail.timeoutSeconds",{defaultMessage:"{timeout} seconds",values:{timeout:e}})}getCreatedAtDate(){return this.formatDate(this.created_at)}getCreatedBy(){return this.created_by||c.i18n.translate("reporting.jobCreatedBy.unknownUserPlaceholderText",{defaultMessage:"Unknown"})}getCreatedAtLabel(){return this.created_by?(0,h.jsx)(n().Fragment,null,(0,h.jsx)("div",null,this.formatDate(this.created_at)),(0,h.jsx)("span",null,this.created_by)):this.formatDate(this.created_at)}getError(){if(this.status===m)return this.warnings}getDeprecatedMessage(){if(this.isDeprecated)return c.i18n.translate("reporting.jobWarning.exportTypeDeprecated",{defaultMessage:"This is a deprecated export type. Automation of this report will need to be re-created for compatibility with future versions of Kibana."})}getWarnings(){var e;const t=[],r=this.getDeprecatedMessage();if(r&&t.push(r),this.csv_contains_formulas&&t.push(c.i18n.translate("reporting.jobWarning.csvContainsFormulas",{defaultMessage:"Your CSV contains characters that spreadsheet applications might interpret as formulas."})),this.max_size_reached&&t.push(c.i18n.translate("reporting.jobWarning.maxSizeReachedTooltip",{defaultMessage:"Your search reached the max size and contains partial data."})),this.status!==m&&null!==(e=this.warnings)&&void 0!==e&&e.length&&t.push(...this.warnings),t.length)return(0,h.jsx)("ul",null,t.map(((e,t)=>(0,h.jsx)("li",{key:`warning-key-${t}`},e))))}getPrettyStatusTimestamp(){return this.formatDate(this.getStatusTimestamp())}formatDate(e){try{return o()(e).format("YYYY-MM-DD @ hh:mm A")}catch(t){return e}}getStatusTimestamp(){const e=this.status;return e===v&&this.started_at?this.started_at:this.completed_at&&[f,m,y].includes(e)?this.completed_at:this.created_at}}const S=new Map([[b,c.i18n.translate("reporting.jobStatuses.pendingText",{defaultMessage:"Pending"})],[v,c.i18n.translate("reporting.jobStatuses.processingText",{defaultMessage:"Processing"})],[f,c.i18n.translate("reporting.jobStatuses.completedText",{defaultMessage:"Completed"})],[y,c.i18n.translate("reporting.jobStatuses.warningText",{defaultMessage:"Completed"})],[m,c.i18n.translate("reporting.jobStatuses.failedText",{defaultMessage:"Failed"})]]);function x(){return{getPendingJobIds:function(){const e=[];for(const t in localStorage)if(0===t.indexOf(d.fW)){const r=t.replace(`${d.fW}-`,"");e.push(r)}return e},addPendingJobId:function(e){localStorage.setItem(`${d.fW}-${e}`,e)},setPendingJobIds:function(e){for(const e in localStorage)0===e.indexOf(d.fW)&&localStorage.removeItem(e);for(let t=0;t<e.length;t++){const r=e[t];localStorage.setItem(`${d.fW}-${r}`,r)}}}}const j=(0,s.createContext)(void 0),_=({apiClient:e,http:t,children:r})=>(0,h.jsx)(j.Provider,{value:{http:t,apiClient:e}},r),w=()=>{const e=(0,s.useContext)(j);if(!e)throw new Error('"useInternalApiClient" can only be used inside of "InternalApiClientContext"');return e};var E=r(8744);const P=()=>{const{services:{http:e}}=D();return(0,E.useRequest)(e,{path:d.lJ.MIGRATE.GET_ILM_POLICY_STATUS,method:"get"})},C=__kbnSharedDeps__.KbnRison;var R=r.n(C),M=r(151),T=r(3721);class ReportingAPIClient{constructor(e,t,r){(0,a.default)(this,"http",void 0),(0,a.default)(this,"addPendingJobId",x().addPendingJobId),(0,a.default)(this,"getManagementLink",(()=>this.http.basePath.prepend(d.xU))),(0,a.default)(this,"getDownloadLink",(e=>this.getReportURL(e))),(0,a.default)(this,"getServerBasePath",(()=>this.http.basePath.serverBasePath)),this.uiSettings=t,this.kibanaVersion=r,this.http=e}getKibanaAppHref(e){const t=(0,M.stringify)({jobId:e.id});return`${(0,d.yc)({basePath:this.http.basePath.serverBasePath,spaceId:e.spaceId,appPath:d.Cd})}?${t}`}getReportURL(e){return this.http.basePath.prepend(`${d.lJ.JOBS.DOWNLOAD_PREFIX}/${e}?elasticInternalOrigin=true`)}downloadReport(e){const t=this.getReportURL(e);window.open(t)}async deleteReport(e){return await this.http.delete(`${d.lJ.JOBS.DELETE_PREFIX}/${e}`)}async list(e=0,t=[]){const r={page:e};return t.length>0&&(r.ids=t.slice(0,10).join(",")),(await this.http.get(d.lJ.JOBS.LIST,{query:r,asSystemRequest:!0})).map((e=>new Job(e)))}async total(){return await this.http.get(d.lJ.JOBS.COUNT,{asSystemRequest:!0})}async getError(e){var t;const r=await this.getInfo(e);return null!==(t=r.warnings)&&void 0!==t&&t[0]?r.warnings[0]:c.i18n.translate("reporting.apiClient.unknownError",{defaultMessage:"Report job {job} failed. Error unknown.",values:{job:e}})}async getInfo(e){const t=await this.http.get(`${d.lJ.JOBS.INFO_PREFIX}/${e}`);return new Job(t)}async findForJobIds(e){return(await this.http.fetch(d.lJ.JOBS.LIST,{query:{page:0,ids:e.join(",")},method:"GET"})).map((e=>new Job(e)))}getReportingPublicJobPath(e,t){const r=(0,M.stringify)({jobParams:R().encode(t)});return`${this.http.basePath.prepend(d.Ff.GENERATE_PREFIX)}/${e}?${r}`}async createReportingShareJob(e,t){const r=R().encode(t),a=await this.http.post(`${d.lJ.GENERATE_PREFIX}/${e}`,{method:"POST",body:JSON.stringify({jobParams:r})});if(null!=a&&a.job)return this.addPendingJobId(a.job.id),new Job(a.job)}async createReportingJob(e,t){const r=R().encode(t);try{const t=await this.http.post(`${d.lJ.GENERATE_PREFIX}/${e}`,{method:"POST",body:JSON.stringify({jobParams:r})});if(null!=t&&t.job)return this.addPendingJobId(t.job.id),new Job(t.job)}catch(e){var a;throw T.error(e),new Error(`${null===(a=e.body)||void 0===a?void 0:a.message}`)}}async createImmediateReport(e){const{objectType:t,...r}=e;return this.http.post(d.lJ.DOWNLOAD_CSV,{asResponse:!0,body:JSON.stringify(r)})}getDecoratedJobParams(e){return{browserTimezone:"Browser"===this.uiSettings.get("dateFormat:tz")?o().tz.guess():this.uiSettings.get("dateFormat:tz"),version:this.kibanaVersion,...e}}verifyBrowser(){return this.http.get(d.lJ.DIAGNOSE.BROWSER)}verifyScreenCapture(){return this.http.post(d.lJ.DIAGNOSE.SCREENSHOT)}migrateReportingIndicesIlmPolicy(){return this.http.put(d.lJ.MIGRATE.MIGRATE_ILM_POLICY)}}var k=r(5190),O=r(409);const D=()=>(0,O.useKibana)()},5190:(e,t,r)=>{"use strict";r.d(t,{q:()=>a});const a=e=>{switch(e.state){case"valid":default:return{showLinks:!0,enableLinks:!0,message:""};case"invalid":return{showLinks:!1,enableLinks:!1,message:"Your license does not support Reporting. Please upgrade your license."};case"unavailable":return{showLinks:!0,enableLinks:!1,message:"You cannot use Reporting because license information is not available at this time."};case"expired":return{showLinks:!0,enableLinks:!1,message:"You cannot use Reporting because your license has expired."}}}},5228:(e,t,r)=>{"use strict";r.d(t,{Pv:()=>l});var a=r(4286),i=r(2874),o=r.n(i),s=r(482),n=r(6791);const l=(e,t)=>r=>(o().render((0,n.jsx)(s.KibanaRenderContextProvider,t,e),r),()=>o().unmountComponentAtNode(r));r(8915),r(5008),a.Component},3671:(e,t,r)=>{"use strict";r.r(t),r.d(t,{plugin:()=>q});var a=r(8915),i=r(190),o=r(7546),s=r(5008),n=r(6743),l=r(3107),c=r(5879),d=r(5228),u=r(4286),p=r.n(u),g=r(5190),h=r(6791);const f=(e,t)=>()=>{const{objectType:r,sharingData:{title:a,locatorParams:i},optimizedForPrinting:o}=e,s=document.querySelector("[data-shared-items-container]"),{height:n,width:l}=s?s.getBoundingClientRect():{height:768,width:1024},c={objectType:r,layout:{id:o?"print":"preserve_layout",dimensions:{height:n,width:l}},title:a};return"printablePdfV2"===t?{...c,locatorParams:[i]}:{...c,locatorParams:i}};var m=r(1485);const b=({apiClient:e,searchModeParams:t,title:r})=>{const a=t.isEsqlMode?m.tE:m.wn,i={title:r,objectType:"search"};return t.isEsqlMode?{reportType:a,decoratedJobParams:e.getDecoratedJobParams({...i,locatorParams:t.locatorParams})}:{reportType:a,decoratedJobParams:e.getDecoratedJobParams({...i,columns:t.columns,searchSource:t.searchSource})}};var v=r(3185),y=r(7519),S=r(8628),x=r(1319);const j=()=>(0,h.jsx)(u.Fragment,null,(0,h.jsx)(x.EuiSpacer,null),(0,h.jsx)(x.EuiFlexGroup,{justifyContent:"spaceAround"},(0,h.jsx)(x.EuiFlexItem,{grow:!1},(0,h.jsx)(x.EuiLoadingSpinner,{size:"l"}))),(0,h.jsx)(x.EuiSpacer,null)),_=(0,u.lazy)((()=>r.e(604).then(r.bind(r,3604)).then((({ScreenCapturePanelContent:e})=>({default:e}))))),w=e=>(0,h.jsx)(u.Suspense,{fallback:(0,h.jsx)(j,null)},(0,h.jsx)(_,e));function E(e,t){return{ReportingPanelPDFV2:r=>"canvas"===r.layoutOption?(0,h.jsx)(w,(0,v.default)({requiresSavedState:!1,reportType:y.cU,apiClient:e,layoutOption:"canvas",startServices$:t},r)):null,ReportingPanelPNGV2(r){if("canvas"===r.layoutOption)return(0,h.jsx)(w,(0,v.default)({requiresSavedState:!1,reportType:S.F,apiClient:e,layoutOption:"canvas",startServices$:t},r))}}}var P=r(1286),C=r(1050);const R=e=>Boolean(e&&void 0!==(null==e?void 0:e.parentApi)),M=e=>Boolean(e&&void 0!==(null==e?void 0:e.viewMode$)),T=__kbnSharedDeps__.KbnEsQuery;r(4513);var k=r(4839),O=r(3721);const D=e=>{return(e=>Boolean(e&&e.type))(e)&&((e,t)=>Boolean(e&&e.type)&&e.type===t)(e,P.SEARCH_EMBEDDABLE_TYPE)&&(0,P.apiPublishesSavedSearch)(e)&&(e=>M(e)||R(e)&&M(e.parentApi))(e)&&Boolean(e.hasTimeRange)&&(t=e,Boolean(t&&void 0!==(null==t?void 0:t.title$)&&void 0!==(null==t?void 0:t.hideTitle$)));var t};class ReportingCsvPanelAction{constructor({core:e,csvConfig:t,apiClient:r,startServices$:n,usesUiCapabilities:l}){(0,a.default)(this,"isDownloading",void 0),(0,a.default)(this,"type",""),(0,a.default)(this,"id",m.By),(0,a.default)(this,"i18nStrings",void 0),(0,a.default)(this,"notifications",void 0),(0,a.default)(this,"apiClient",void 0),(0,a.default)(this,"enablePanelActionDownload",void 0),(0,a.default)(this,"usesUiCapabilities",void 0),(0,a.default)(this,"startServices$",void 0),(0,a.default)(this,"isCompatible",(async e=>{var t;const{embeddable:r}=e;if(!D(r))return!1;const[{application:a},{licensing:s}]=await(0,i.firstValueFrom)(this.startServices$),n=await(0,i.firstValueFrom)(s.license$),l=(0,g.q)(n.check("reporting","basic")).showLinks,c=!this.usesUiCapabilities||!0===(null===(t=a.capabilities.dashboard)||void 0===t?void 0:t.downloadCsv);return!(!l||!c)&&(M(d=r)?d.viewMode$.getValue():R(d)&&M(d.parentApi)?d.parentApi.viewMode$.getValue():void 0)!==o.ViewMode.EDIT;var d})),(0,a.default)(this,"executeDownload",(async e=>{const[t]=await(0,i.firstValueFrom)(this.startServices$),{searchSource:r,columns:a,title:o}=e,s=this.apiClient.getDecoratedJobParams({searchSource:r,columns:a,title:o,objectType:"downloadCsv"});this.isDownloading=!0,this.notifications.toasts.addSuccess({title:this.i18nStrings.download.toasts.success.title,text:(0,d.Pv)(this.i18nStrings.download.toasts.success.body,t),"data-test-subj":"csvDownloadStarted"}),await this.apiClient.createImmediateReport(s).then((({body:e,response:t})=>{this.isDownloading=!1;const r=`${o}.csv`,a=new Blob([e],{type:(null==t?void 0:t.headers.get("content-type"))||void 0});if(window.navigator.msSaveOrOpenBlob)return window.navigator.msSaveOrOpenBlob(a,r);const i=window.document.createElement("a"),s=window.URL.createObjectURL(a);i.href=s,i.download=r,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(s),document.body.removeChild(i)})).catch((e=>{O.error(e),this.isDownloading=!1,this.notifications.toasts.addDanger({title:this.i18nStrings.download.toasts.error.title,text:this.i18nStrings.download.toasts.error.body,"data-test-subj":"downloadCsvFail"})}))})),(0,a.default)(this,"executeGenerate",(async e=>{const[t]=await(0,i.firstValueFrom)(this.startServices$),{searchModeParams:r,title:a}=e,{reportType:o,decoratedJobParams:s}=b({apiClient:this.apiClient,searchModeParams:r,title:a});await this.apiClient.createReportingJob(o,s).then((e=>{e&&this.notifications.toasts.addSuccess({title:this.i18nStrings.generate.toasts.success.title,text:(0,d.Pv)(this.i18nStrings.generate.toasts.success.body,t),"data-test-subj":"csvReportStarted"})})).catch((e=>{O.error(e),this.notifications.toasts.addDanger({title:this.i18nStrings.generate.toasts.error.title,text:this.i18nStrings.generate.toasts.error.body,"data-test-subj":"generateCsvFail"})}))})),(0,a.default)(this,"getDiscoverLocatorParamsForEsqlCSV",((e,t,r)=>{var a,i;const o=null===(a=e.savedObjectId$)||void 0===a?void 0:a.getValue();return{...o?{savedSearchId:o}:{},query:t.query,filters:null===(i=t.parent)||void 0===i?void 0:i.filter,columns:r}})),(0,a.default)(this,"execute",(async e=>{var t;const{embeddable:r}=e;if(!D(r)||!await this.isCompatible(e))throw new k.IncompatibleActionError;const a=r.savedSearch$.getValue();if(!a||this.isDownloading)return;const[{i18n:o,analytics:s}]=await(0,i.firstValueFrom)(this.startServices$),n=null!==(t=r.title$.getValue())&&void 0!==t?t:"",l={title:n,i18nStart:o,analytics:s},{columns:c,getSearchSource:d}=await this.getSharingData(a),u=d({addGlobalTimeFilter:!r.hasTimeRange(),absoluteTime:!0});if(this.enablePanelActionDownload){const e={searchSource:u,columns:c,title:n,savedSearch:a,i18nStart:o,analytics:s};return this.executeDownload(e)}return this.isEsqlMode(a)?this.executeGenerate({...l,searchModeParams:{isEsqlMode:!0,locatorParams:[{id:C.DISCOVER_APP_LOCATOR,params:this.getDiscoverLocatorParamsForEsqlCSV(r,u,c)}]}}):this.executeGenerate({...l,searchModeParams:{isEsqlMode:!1,searchSource:u,columns:c}})})),this.isDownloading=!1,this.apiClient=r,this.enablePanelActionDownload=!0===t.enablePanelActionDownload,this.notifications=e.notifications,this.startServices$=n,this.usesUiCapabilities=l,this.i18nStrings=(e=>({download:{displayName:s.i18n.translate("reporting.share.panelAction.downloadCsvPanelTitle",{defaultMessage:"Download CSV"}),toasts:{error:{title:s.i18n.translate("reporting.share.panelAction.failedCsvReportTitle",{defaultMessage:"CSV download failed"}),body:s.i18n.translate("reporting.share.panelAction.failedCsvReportMessage",{defaultMessage:"We couldn't download your CSV at this time."})},success:{title:s.i18n.translate("reporting.share.panelAction.csvDownloadStartedTitle",{defaultMessage:"CSV download started"}),body:(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.panelAction.csvDownloadStartedMessage",defaultMessage:"Your CSV will download momentarily."})}}},generate:{displayName:s.i18n.translate("reporting.share.panelAction.generateCsvPanelTitle",{defaultMessage:"Generate CSV report"}),toasts:{error:{title:s.i18n.translate("reporting.share.panelAction.failedGenerateCsvReportTitle",{defaultMessage:"CSV report failed"}),body:s.i18n.translate("reporting.share.panelAction.failedGenerateCsvReportMessage",{defaultMessage:"We couldn't generate your CSV at this time."})},success:{title:s.i18n.translate("reporting.share.panelAction.csvReportStartedTitle",{defaultMessage:"Queued report for CSV"}),body:(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.panelAction.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:(0,h.jsx)("a",{href:e.getManagementLink()},(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.panelAction.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}})}}}}))(r)}getIconType(){return"document"}getDisplayName(){return this.enablePanelActionDownload?this.i18nStrings.download.displayName:this.i18nStrings.generate.displayName}async getSharingData(e){const[{uiSettings:t},{data:r}]=await(0,i.firstValueFrom)(this.startServices$),{getSharingData:a}=await(0,P.loadSharingDataHelpers)();return await a(e.searchSource,e,{uiSettings:t,data:r},this.isEsqlMode(e))}isEsqlMode(e){return(0,T.isOfAggregateQueryType)(e.searchSource.getField("query"))}}var F=r(7023),I=r(7885);const L=(e,t,r,a,i)=>({title:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.couldNotCreateReportTitle",defaultMessage:"Cannot create {reportType} report for ''{reportObjectTitle}''.",values:{reportType:t.jobtype,reportObjectTitle:t.title}}),i),text:(0,d.Pv)((0,h.jsx)(p().Fragment,null,(0,h.jsx)(x.EuiCallOut,{size:"m",color:"danger","data-test-errorText":e},t.errorCode===F.zf.code?I.u.cloud.insufficientMemoryError(a.links.reporting.cloudMinimumRequirements):e),(0,h.jsx)(x.EuiSpacer,null),(0,h.jsx)("p",null,(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.checkManagement",defaultMessage:"Go to {path} for details.",values:{path:(0,h.jsx)("a",{href:r()},(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Kibana > Reporting"}))}}))),i),iconType:void 0,"data-test-subj":"completeReportFailure"}),N=(e,t,r)=>({text:(0,d.Pv)((0,h.jsx)(p().Fragment,null,(0,h.jsx)(x.EuiCallOut,{title:e,color:"danger",iconType:"warning"},t.toString()),(0,h.jsx)(x.EuiSpacer,null),(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.tryRefresh",defaultMessage:"Try refreshing the page."})),r),iconType:void 0}),A=({getUrl:e,job:t})=>(0,h.jsx)(x.EuiButton,{size:"s","data-test-subj":"downloadCompletedReportButton",href:e(t.id),target:"_blank"},(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.downloadReportButtonLabel",defaultMessage:"Download report"})),U=({getUrl:e})=>(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.reportLinkDescription",defaultMessage:"Download it now, or get it later in {path}.",values:{path:(0,h.jsx)("a",{href:e()},(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),$=(e,t,r,a)=>({title:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.successfullyCreatedReportNotificationTitle",defaultMessage:"{reportType} created for ''{reportObjectTitle}''",values:{reportType:e.jobtype,reportObjectTitle:e.title}}),a),color:"success",text:(0,d.Pv)((0,h.jsx)(p().Fragment,null,(0,h.jsx)("p",null,(0,h.jsx)(U,{getUrl:t})),(0,h.jsx)(A,{getUrl:r,job:e})),a),"data-test-subj":"completeReportSuccess"}),J=(e,t,r,a)=>({title:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.csvContainsFormulas.formulaReportTitle",defaultMessage:"{reportType} may contain formulas",values:{reportType:e.jobtype}}),a),text:(0,d.Pv)((0,h.jsx)(p().Fragment,null,(0,h.jsx)("p",null,(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.csvContainsFormulas.formulaReportMessage",defaultMessage:"The report ''{reportObjectTitle}'' contains characters which spreadsheet applications can interpret as formulas.",values:{reportObjectTitle:e.title}})),(0,h.jsx)("p",null,(0,h.jsx)(U,{getUrl:t})),(0,h.jsx)(A,{getUrl:r,job:e})),a),"data-test-subj":"completeReportCsvFormulasWarning"}),B=(e,t,r,a)=>({title:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.maxSizeReached.partialReportTitle",defaultMessage:"Created partial {reportType} for ''{reportObjectTitle}''",values:{reportType:e.jobtype,reportObjectTitle:e.title}}),a),text:(0,d.Pv)((0,h.jsx)(p().Fragment,null,(0,h.jsx)("p",null,(0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.maxSizeReached.partialReportDescription",defaultMessage:"The report reached the max size and contains partial data."})),(0,h.jsx)("p",null,(0,h.jsx)(U,{getUrl:t})),(0,h.jsx)(A,{getUrl:r,job:e})),a),"data-test-subj":"completeReportMaxSizeWarning"}),V=(e,t,r,a)=>({title:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"xpack.reporting.publicNotifier.warning.title",defaultMessage:"{reportType} completed with issues",values:{reportType:e.jobtype}}),a),text:(0,d.Pv)((0,h.jsx)(p().Fragment,null,(0,h.jsx)("p",null,(0,h.jsx)(U,{getUrl:t})),(0,h.jsx)(A,{getUrl:r,job:e})),a),"data-test-subj":"completeReportWarning"});var G=r(3721);function z(e){var t;return{id:e.id,status:e.status,title:e.title,jobtype:null!==(t=e.prettyJobTypeName)&&void 0!==t?t:e.jobtype,maxSizeReached:e.max_size_reached,csvContainsFormulas:e.csv_contains_formulas,errorCode:e.error_code}}class ReportingNotifierStreamHandler{constructor(e,t){(0,a.default)(this,"jobCompletionNotifications",(0,l.jobCompletionNotifications)()),this.apiClient=e,this.core=t}startPolling(e,t){i.timer(0,e).pipe((0,i.takeUntil)(t),(0,i.map)(this.jobCompletionNotifications.getPendingJobIds),(0,i.filter)((e=>e.length>0)),(0,i.mergeMap)((e=>this.findChangedStatusJobs(e))),(0,i.mergeMap)((({completed:e,failed:t})=>this.showNotifications({completed:e,failed:t}))),(0,i.catchError)((e=>(G.error(e),function(e,t){return e.notifications.toasts.addDanger(N(s.i18n.translate("xpack.reporting.publicNotifier.pollingErrorMessage",{defaultMessage:"Reporting notifier error!"}),t,e)),window.console.error(t),i.of({completed:[],failed:[]})}(this.core,e))))).subscribe()}showNotifications({completed:e,failed:t}){const r=this.core.notifications,a=this.apiClient,o=this.core,s=this.core.docLinks,l=a.getManagementLink.bind(a),c=a.getDownloadLink.bind(a);return i.from((async()=>{const i={toastLifeTimeMs:864e5};for(const t of null!=e?e:[])t.csvContainsFormulas?r.toasts.addWarning(J(t,l,c,o),i):t.maxSizeReached?r.toasts.addWarning(B(t,l,c,o),i):t.status===n.Pm.WARNINGS?r.toasts.addWarning(V(t,l,c,o),i):r.toasts.addSuccess($(t,l,c,o),i);for(const e of null!=t?t:[]){const t=await a.getError(e.id);r.toasts.addDanger(L(t,e,l,s,o))}return{completed:e,failed:t}})())}findChangedStatusJobs(e){return i.from(this.apiClient.findForJobIds(e)).pipe((0,i.mergeMap)((async t=>{const r=[],a=[],i=[];for(const o of e){const e=t.find((({id:e})=>e===o));(null==e?void 0:e.status)===n.Pm.COMPLETED||(null==e?void 0:e.status)===n.Pm.WARNINGS?r.push(z(e)):(null==e?void 0:e.status)===n.Pm.FAILED?a.push(z(e)):i.push(o)}return this.jobCompletionNotifications.setPendingJobIds(i),{completed:r,failed:a}})),(0,i.catchError)((e=>(this.core.notifications.toasts.addDanger(N(s.i18n.translate("xpack.reporting.publicNotifier.httpErrorMessage",{defaultMessage:"Could not check Reporting job status!"}),e,this.core)),window.console.error(e),i.of({})))))}}class ReportingPublicPlugin{constructor(e){(0,a.default)(this,"kibanaVersion",void 0),(0,a.default)(this,"apiClient",void 0),(0,a.default)(this,"stop$",new i.ReplaySubject(1)),(0,a.default)(this,"title",s.i18n.translate("xpack.reporting.management.reportingTitle",{defaultMessage:"Reporting"})),(0,a.default)(this,"breadcrumbText",s.i18n.translate("xpack.reporting.breadcrumb",{defaultMessage:"Reporting"})),(0,a.default)(this,"config",void 0),(0,a.default)(this,"contract",void 0),(0,a.default)(this,"startServices$",void 0),this.config=e.config.get(),this.kibanaVersion=e.env.packageInfo.version}getContract(e,t){if(this.contract={usesUiCapabilities:()=>{var e;return!1===(null===(e=this.config.roles)||void 0===e?void 0:e.enabled)},components:E(e,t)},!this.contract)throw new Error("Setup error in Reporting plugin!");return this.contract}setup(e,t){const{getStartServices:a}=e,{home:n,management:u,screenshotMode:p,share:m,uiActions:v}=t,y=(0,i.from)(a()).pipe((0,i.map)((([e,...t])=>[{application:e.application,analytics:e.analytics,i18n:e.i18n,theme:e.theme,userProfile:e.userProfile,notifications:e.notifications,uiSettings:e.uiSettings},...t]))),S=!this.config.roles.enabled,x=new l.ReportingAPIClient(e.http,e.uiSettings,this.kibanaVersion);return this.apiClient=x,n.featureCatalogue.register({id:"reporting",title:s.i18n.translate("xpack.reporting.registerFeature.reportingTitle",{defaultMessage:"Reporting"}),description:s.i18n.translate("xpack.reporting.registerFeature.reportingDescription",{defaultMessage:"Manage your reports generated from Discover, Visualize, and Dashboard."}),icon:"reportingApp",path:"/app/management/insightsAndAlerting/reporting",showOnHomePage:!1,category:"admin"}),u.sections.section.insightsAndAlerting.registerApp({id:"reporting",title:this.title,order:3,keywords:["reports","report","reporting"],mount:async e=>{e.setBreadcrumbs([{text:this.breadcrumbText}]);const[[t,i],{mountManagementSection:o}]=await Promise.all([a(),r.e(40).then(r.bind(r,9040))]),{licensing:s,data:n,share:l}=i,{docTitle:c}=t.chrome;c.change(this.title);const d=await o(t,s.license$,n,l,this.config,x,e);return()=>{c.reset(),d()}}}),e.application.register({id:"reportingRedirect",mount:async t=>{const[a,i]=await Promise.all([e.getStartServices(),r.e(926).then(r.bind(r,5926))]),[o]=a,{mountRedirectApp:s}=i;return s(o,{...t,apiClient:x,screenshotMode:p,share:m})},title:"Reporting redirect app",chromeless:!0,exactRoute:!0,visibleIn:[]}),v.addTriggerAction(o.CONTEXT_MENU_TRIGGER,new ReportingCsvPanelAction({core:e,apiClient:x,startServices$:y,usesUiCapabilities:S,csvConfig:this.config.csv})),y.subscribe((([{application:e},{licensing:t}])=>{t.license$.subscribe((t=>{m.register((({apiClient:e,application:t,license:r,usesUiCapabilities:a,startServices$:o})=>({id:"csvReportsModal",getShareMenuItems:({objectType:n,sharingData:u,toasts:p})=>{if("search"!==n)return[];const g=u.getSearchSource,f=e=>u.isTextBased?{isEsqlMode:!0,locatorParams:u.locatorParams}:{isEsqlMode:!1,columns:u.columns,searchSource:g({addGlobalTimeFilter:!0,absoluteTime:!e})},m=[],v=(0,l.checkLicense)(r.check("reporting","basic")),y=v.message,S=v.showLinks,x=!v.enableLinks;let j=!1;var _;j=!a||!0===(null===(_=t.capabilities.discover)||void 0===_?void 0:_.generateCsv);const w=({intl:t})=>{const{reportType:r,decoratedJobParams:a}=b({apiClient:e,searchModeParams:f(!1),title:u.title});return e.createReportingShareJob(r,a).then((()=>(0,i.firstValueFrom)(o))).then((([r])=>{p.addSuccess({title:t.formatMessage({id:"reporting.share.modalContent.successfullyQueuedReportNotificationTitle",defaultMessage:"Queued report for {objectType}"},{objectType:n}),text:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"reporting.share.modalContent.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:(0,h.jsx)("a",{href:e.getManagementLink()},(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),r),"data-test-subj":"queueReportSuccess"})})).catch((e=>{var r;p.addError(e,{title:t.formatMessage({id:"reporting.share.modalContent.notification.reportingErrorTitle",defaultMessage:"Unable to create report"}),toastMessage:(0,h.jsx)("span",{dangerouslySetInnerHTML:{__html:null===(r=e.body)||void 0===r?void 0:r.message}})})}))};if(S&&j){const t=s.i18n.translate("reporting.share.contextMenu.export.csvReportsButtonLabel",{defaultMessage:"Export"}),r=new URL(window.location.origin),{reportType:a,decoratedJobParams:i}=b({apiClient:e,searchModeParams:f(!0),title:u.title}),o=e.getReportingPublicJobPath(a,i),l=new URL(o,window.location.href).toString();m.push({shareMenuItem:{name:t,toolTipContent:y,disabled:x,"data-test-subj":"Export"},helpText:(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.csv.reporting.helpTextCSV",defaultMessage:"Export a CSV of this {objectType}.",values:{objectType:n}}),reportType:a,label:"CSV",copyURLButton:{id:"reporting.share.modalContent.csv.copyUrlButtonLabel",dataTestSubj:"shareReportingCopyURL",label:"Post URL"},generateExportButton:(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.generateButtonLabelCSV","data-test-subj":"generateReportButton",defaultMessage:"Generate CSV"}),generateExport:w,generateExportUrl:()=>l,generateCopyUrl:r,renderCopyURLButton:!0})}return m}}))({apiClient:x,license:t,application:e,usesUiCapabilities:S,startServices$:y})),(this.config.export_types.pdf.enabled||this.config.export_types.png.enabled)&&m.register((({apiClient:e,license:t,application:r,usesUiCapabilities:a,startServices$:o})=>({id:"modalImageReports",getShareMenuItems:({objectType:n,objectId:l,isDirty:u,onClose:p,shareableUrl:m,shareableUrlForSavedObject:b,toasts:v,...y})=>{const{enableLinks:S,showLinks:x,message:j}=(0,g.q)(t.check("reporting","gold")),_=j,w=x,E=!S;let P=!1,C=!1;var R,M;if(a?(P=!0===(null===(R=r.capabilities.dashboard)||void 0===R?void 0:R.generateScreenshot),C=!0===(null===(M=r.capabilities.visualize)||void 0===M?void 0:M.generateScreenshot)):(P=!0,C=!0),!w)return[];const T=["dashboard","visualization","lens"].includes(n);if(!T)return[];if("dashboard"===n&&!P)return[];if(T&&!C&&!P)return[];const{sharingData:k}=y,O=[],D={shareableUrl:u?m:null!=b?b:m,objectType:n,sharingData:k},F=null===k.locatorParams;return O.push({shareMenuItem:{name:s.i18n.translate("reporting.shareContextMenu.ExportsButtonLabel",{defaultMessage:"PDF"}),toolTipContent:_,disabled:E||k.reportingDisabled,"data-test-subj":"imageExports"},label:"PDF",generateExport:({intl:t,optimizedForPrinting:r=!1})=>{const a=e.getDecoratedJobParams({...f({...D,optimizedForPrinting:r},"printablePdfV2")()});return e.createReportingJob("printablePdfV2",a).then((()=>(0,i.firstValueFrom)(o))).then((([r])=>{v.addSuccess({title:t.formatMessage({id:"reporting.share.modalContent.successfullyQueuedReportNotificationTitle",defaultMessage:"Queued report for {objectType}"},{objectType:n}),text:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"reporting.share.modalContent.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:(0,h.jsx)("a",{href:e.getManagementLink()},(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),r),"data-test-subj":"queueReportSuccess"})})).catch((e=>{var r;v.addError(e,{title:t.formatMessage({id:"reporting.share.modalContent.notification.reportingErrorTitle",defaultMessage:"Unable to create report"}),toastMessage:null===(r=e.body)||void 0===r?void 0:r.message})}))},generateExportUrl:({optimizedForPrinting:t})=>{const r=e.getDecoratedJobParams(f({...D,optimizedForPrinting:t},"printablePdfV2")()),a=e.getReportingPublicJobPath("printablePdfV2",r);return new URL(a,window.location.href).toString()},reportType:"printablePdfV2",requiresSavedState:F,layoutOption:"dashboard"===n?"print":void 0,renderLayoutOptionSwitch:"dashboard"===n,renderCopyURLButton:!0}),O.push({shareMenuItem:{name:s.i18n.translate("reporting.shareContextMenu.ExportsButtonLabelPNG",{defaultMessage:"PNG export"}),toolTipContent:_,disabled:E||k.reportingDisabled,"data-test-subj":"imageExports"},label:"PNG",generateExport:({intl:t})=>{const r=e.getDecoratedJobParams({...f(D,"pngV2")()});return e.createReportingJob("pngV2",r).then((()=>(0,i.firstValueFrom)(o))).then((([r])=>{v.addSuccess({title:t.formatMessage({id:"reporting.share.modalContent.successfullyQueuedReportNotificationTitle",defaultMessage:"Queued report for {objectType}"},{objectType:n}),text:(0,d.Pv)((0,h.jsx)(c.FormattedMessage,{id:"reporting.share.modalContent.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:(0,h.jsx)("a",{href:e.getManagementLink()},(0,h.jsx)(c.FormattedMessage,{id:"reporting.share.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),r),"data-test-subj":"queueReportSuccess"})})).catch((e=>{var r;v.addError(e,{title:t.formatMessage({id:"reporting.share.modalContent.notification.reportingErrorTitle",defaultMessage:"Unable to create report"}),toastMessage:null===(r=e.body)||void 0===r?void 0:r.message})}))},generateExportUrl:()=>{const t=e.getDecoratedJobParams(f(D,"pngV2")()),r=e.getReportingPublicJobPath("pngV2",t);return new URL(r,window.location.href).toString()},reportType:"pngV2",requiresSavedState:F,layoutOption:"dashboard"===n?"print":void 0,renderCopyURLButton:!0}),O}}))({apiClient:x,license:t,application:e,usesUiCapabilities:S,startServices$:y}))}))})),this.startServices$=y,this.getContract(x,y)}start(e){const t=new ReportingNotifierStreamHandler(this.apiClient,e),r=(0,n.l6)(this.config.poll.jobsRefresh.interval);return t.startPolling(r,this.stop$),this.getContract(this.apiClient,this.startServices$)}stop(){this.stop$.next()}}function q(e){return new ReportingPublicPlugin(e)}},7885:(e,t,r)=>{"use strict";r.d(t,{u:()=>n}),r(4286);var a=r(5008),i=r(5879),o=r(1319),s=r(6791);const n={cloud:{insufficientMemoryError:e=>(0,s.jsx)(i.FormattedMessage,{id:"xpack.reporting.listing.infoPanel.callout.cloud.insufficientMemoryError",defaultMessage:"Kibana needs more memory to generate this report. Check {link}.",values:{link:(0,s.jsx)(o.EuiLink,{href:e},a.i18n.translate("xpack.reporting.listing.infoPanel.callout.cloud.insufficientMemoryError.urlLink",{defaultMessage:"RAM requirements"}))}})}}},6214:e=>{"use strict";var t="%[a-f0-9]{2}",r=new RegExp("("+t+")|([^%]+?)","gi"),a=new RegExp("("+t+")+","gi");function i(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),a=e.slice(t);return Array.prototype.concat.call([],i(r),i(a))}function o(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(r)||[],a=1;a<t.length;a++)t=(e=i(t,a).join("")).match(r)||[];return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=a.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var i=o(r[0]);i!==r[0]&&(t[r[0]]=i)}r=a.exec(e)}t["%C2"]="�";for(var s=Object.keys(t),n=0;n<s.length;n++){var l=s[n];e=e.replace(new RegExp(l,"g"),t[l])}return e}(e)}}},4513:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var a,i,o;if(Array.isArray(t)){if((a=t.length)!=r.length)return!1;for(i=a;0!=i--;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((a=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=a;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=a;0!=i--;){var s=o[i];if(!e(t[s],r[s]))return!1}return!0}return t!=t&&r!=r}},151:(e,t,r)=>{"use strict";const a=r(8136),i=r(6214),o=r(1536);function s(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function n(e,t){return t.encode?t.strict?a(e):encodeURIComponent(e):e}function l(e,t){return t.decode?i(e):e}function c(e){return Array.isArray(e)?e.sort():"object"==typeof e?c(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function u(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function p(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function g(e,t){s((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,a)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===a[e]&&(a[e]={}),a[e][t[1]]=r):a[e]=r};case"bracket":return(e,r,a)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==a[e]?a[e]=[].concat(a[e],r):a[e]=[r]:a[e]=r};case"comma":case"separator":return(t,r,a)=>{const i="string"==typeof r&&r.split("").indexOf(e.arrayFormatSeparator)>-1?r.split(e.arrayFormatSeparator).map((t=>l(t,e))):null===r?r:l(r,e);a[t]=i};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),a=Object.create(null);if("string"!=typeof e)return a;if(!(e=e.trim().replace(/^[?#&]/,"")))return a;for(const i of e.split("&")){let[e,s]=o(t.decode?i.replace(/\+/g," "):i,"=");s=void 0===s?null:["comma","separator"].includes(t.arrayFormat)?s:l(s,t),r(l(e,t),s,a)}for(const e of Object.keys(a)){const r=a[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=p(r[e],t);else a[e]=p(r,t)}return!1===t.sort?a:(!0===t.sort?Object.keys(a).sort():Object.keys(a).sort(t.sort)).reduce(((e,t)=>{const r=a[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=c(r):e[t]=r,e}),Object.create(null))}t.extract=u,t.parse=g,t.stringify=(e,t)=>{if(!e)return"";s((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],a=function(e){switch(e.arrayFormat){case"index":return t=>(r,a)=>{const i=r.length;return void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?r:null===a?[...r,[n(t,e),"[",i,"]"].join("")]:[...r,[n(t,e),"[",n(i,e),"]=",n(a,e)].join("")]};case"bracket":return t=>(r,a)=>void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?r:null===a?[...r,[n(t,e),"[]"].join("")]:[...r,[n(t,e),"[]=",n(a,e)].join("")];case"comma":case"separator":return t=>(r,a)=>null==a||0===a.length?r:0===r.length?[[n(t,e),"=",n(a,e)].join("")]:[[r,n(a,e)].join(e.arrayFormatSeparator)];default:return t=>(r,a)=>void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?r:null===a?[...r,n(t,e)]:[...r,[n(t,e),"=",n(a,e)].join("")]}}(t),i={};for(const t of Object.keys(e))r(t)||(i[t]=e[t]);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map((r=>{const i=e[r];return void 0===i?"":null===i?n(r,t):Array.isArray(i)?i.reduce(a(r),[]).join("&"):n(r,t)+"="+n(i,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,a]=o(e,"#");return Object.assign({url:r.split("?")[0]||"",query:g(u(e),t)},t&&t.parseFragmentIdentifier&&a?{fragmentIdentifier:l(a,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0},r);const a=d(e.url).split("?")[0]||"",i=t.extract(e.url),o=t.parse(i,{sort:!1}),s=Object.assign(o,e.query);let l=t.stringify(s,r);l&&(l=`?${l}`);let c=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(c=`#${n(e.fragmentIdentifier,r)}`),`${a}${l}${c}`}},1536:e=>{"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}},8136:e=>{"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},641:(e,t,r)=>{r.p=window.__kbnPublicPath__.reporting},1050:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/discover/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},1286:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/discover/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},7546:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},8744:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/esUiShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},409:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},4839:(e,t,r)=>{r.r(t);var a=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},3721:(e,t,r)=>{e.exports=r(2497)(4971)},3185:(e,t,r)=>{e.exports=r(2497)(51858)},8915:(e,t,r)=>{e.exports=r(2497)(67493)},1319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},6791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},5008:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},5879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},482:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaContextRender},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},1783:e=>{"use strict";e.exports=__kbnSharedDeps__.Moment},4286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},2874:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactDom},190:e=>{"use strict";e.exports=__kbnSharedDeps__.Rxjs},2497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},r={};function a(e){var i=r[e];if(void 0!==i)return i.exports;var o=r[e]={id:e,exports:{}};return t[e](o,o.exports,a),o.exports}a.m=t,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>"reporting.chunk."+e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},a.l=(t,r,i,o)=>{if(e[t])e[t].push(r);else{var s,n;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==t){s=d;break}}s||(n=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.src=t),e[t]=[r];var u=(r,a)=>{s.onerror=s.onload=null,clearTimeout(p);var i=e[t];if(delete e[t],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(a))),r)return r(a)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=u.bind(null,s.onerror),s.onload=u.bind(null,s.onload),n&&document.head.appendChild(s)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={951:0};a.f.j=(t,r)=>{var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise(((r,a)=>i=e[t]=[r,a]));r.push(i[2]=o);var s=a.p+a.u(t),n=new Error;a.l(s,(r=>{if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;n.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",n.name="ChunkLoadError",n.type=o,n.request=s,i[1](n)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,o,[s,n,l]=r,c=0;if(s.some((t=>0!==e[t]))){for(i in n)a.o(n,i)&&(a.m[i]=n[i]);l&&l(a)}for(t&&t(r);c<s.length;c++)o=s[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.reporting_bundle_jsonpfunction=self.reporting_bundle_jsonpfunction||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),a.nc=void 0,a(641),__kbnBundles__.define("plugin/reporting/public",a,3671)})();