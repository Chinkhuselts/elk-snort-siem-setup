(()=>{var e={397:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DISABLE_BFETCH:()=>l,plugin:()=>d,split:()=>c});var s=r(915),n=r(215);const o="elastic-api-version",i="x-elastic-internal-origin",a=__kbnSharedDeps__.Rxjs,c=(e="\n")=>t=>{const r=new a.Subject;let s="";return t.subscribe((t=>{const n=(s+t).split(e);n.slice(0,-1).forEach(r.next.bind(r)),s=n.length?n[n.length-1]:""}),r.error.bind(r),(()=>{r.next(s),r.complete()})),r.pipe((0,a.filter)(Boolean))},u=__kbnSharedDeps__.KbnI18n;class BfetchRequestError extends Error{constructor(e){super(0===e?u.i18n.translate("bfetchError.networkError",{defaultMessage:"Check your network connection and try again."}):u.i18n.translate("bfetchError.networkErrorWithStatus",{defaultMessage:"Check your network connection and try again. Code {code}",values:{code:e}})),(0,s.default)(this,"code",void 0),this.name="BfetchRequestError",this.code=e}}class ItemBuffer{constructor(e){(0,s.default)(this,"list",[]),this.params=e}get length(){return this.list.length}write(e){this.list.push(e);const{flushOnMaxItems:t}=this.params;t&&this.list.length>=t&&this.flush()}clear(){this.list=[]}flush(){this.flushAsync().catch((()=>{}))}async flushAsync(){let e;[e,this.list]=[this.list,[]],await this.params.onFlush(e)}}class TimedItemBuffer extends ItemBuffer{constructor(e){super(e),(0,s.default)(this,"timer",void 0),(0,s.default)(this,"onTimeout",(()=>{this.flush()})),this.params=e}write(e){super.write(e),this.params.maxItemAge&&1===this.length&&(this.timer=setTimeout(this.onTimeout,this.params.maxItemAge))}clear(){clearTimeout(this.timer),super.clear()}flush(){clearTimeout(this.timer),super.flush()}async flushAsync(){clearTimeout(this.timer),await super.flushAsync()}}const l="bfetch:disable";function h({url:e,headers:t={},method:r="POST",body:s="",signal:n,getIsCompressionDisabled:o=()=>!1}){const i=new window.XMLHttpRequest,u=o();u||(e=(e=>{const t=e.includes("?")?"&":"?";return`${e}${t}compress=true`})(e)),i.open(r,e),i.withCredentials=!0,Object.entries(t).forEach((([e,t])=>i.setRequestHeader(e,t)));const l=((e,t)=>{const r=new a.Subject;let s=0,n=!1;const o=()=>0===e.status||e.status>=400,i=()=>{if(n)return;if(o())return;const{responseText:t}=e;s>=t.length||(r.next(t.substr(s)),s=t.length)};e.onprogress=i;const c=()=>{4!==e.readyState&&(n=!0,e.abort(),r.complete(),t&&t.removeEventListener("abort",c))};return t&&t.addEventListener("abort",c),e.onreadystatechange=()=>{n||(i(),4===e.readyState&&(t&&t.removeEventListener("abort",c),o()?r.error(new BfetchRequestError(e.status)):r.complete()))},r})(i,n);i.send(s);const h=l.pipe(c("\n"),(0,a.map)((e=>u?e:function(e){const t=(0,f.toByteArray)(e),r=(0,p.unzlibSync)(t);return(0,p.strFromU8)(r)}(e))),(0,a.share)());return{xhr:i,stream:h}}const p=__kbnSharedDeps__.Fflate;var f=r(367);const m=e=>{const{url:t,fetchStreaming:r=h,flushOnMaxItems:s=25,maxItemAge:o=10,getIsCompressionDisabled:i=()=>!1}=e,[a]=(e=>{const{onCall:t,onBatch:r,maxItemAge:s=10,flushOnMaxItems:n=25}=e,o=new TimedItemBuffer({onFlush:r,maxItemAge:s,flushOnMaxItems:n});return[(...e)=>{const[r,s]=t(...e);return o.write(s),r},o]})({onCall:(e,t)=>{const r=(0,n.defer)(),s={payload:e,future:r,signal:t};return[r.promise,s]},onBatch:async e=>{try{if(0===(e=e.filter((e=>{var t,r;return null!==(t=e.signal)&&void 0!==t&&t.aborted&&e.future.reject(new n.AbortError),!(null!==(r=e.signal)&&void 0!==r&&r.aborted)}))).length)return;const s=e.map((e=>new Promise((t=>{const{promise:r,cleanup:s}=e.signal?(0,n.abortSignalToPromise)(e.signal):{promise:void 0,cleanup:()=>{}},o=()=>{t(),s()};r&&r.catch((()=>{e.future.reject(new n.AbortError),o()})),e.future.promise.then(o,o)})))),o=new AbortController;let a=!1;Promise.all(s).then((()=>{a=!0,o.abort()}));const c=e.map((e=>e.payload)),{stream:u}=r({url:t,body:JSON.stringify({batch:c}),method:"POST",signal:o.signal,getIsCompressionDisabled:i}),l=t=>{const r=(s=t)?s instanceof BfetchRequestError?s:s instanceof Error?{message:s.message}:"object"==typeof s?{...s,message:s.message||"Unknown error."}:{message:String(s)}:{message:"Unknown error."};var s;r.code="STREAM";for(const{future:t}of e)t.reject(r)};u.subscribe({next:t=>{try{const r=JSON.parse(t);r.error?e[r.id].future.reject(r.error):void 0!==r.result&&e[r.id].future.resolve(r.result)}catch(e){l(e)}},error:l,complete:()=>{if(!a){const t={message:"Connection terminated prematurely.",code:"CONNECTION"};for(const{future:r}of e)r.reject(t)}}}),await u.toPromise()}catch(t){for(const r of e)r.future.reject(t)}},flushOnMaxItems:s,maxItemAge:o});return a};class BfetchPublicPlugin{constructor(e){(0,s.default)(this,"contract",void 0),(0,s.default)(this,"fetchStreaming",((e,t,r,s)=>n=>{return h({...n,url:`${r}/${a=n.url,"/"===a[0]?a.substr(1):a}`,headers:{"Content-Type":"application/json","kbn-version":t,[i]:"Kibana",[o]:e,...n.headers||{}},getIsCompressionDisabled:s});var a})),(0,s.default)(this,"batchedFunction",((e,t)=>r=>m({...r,getIsCompressionDisabled:t,fetchStreaming:r.fetchStreaming||e}))),this.initializerContext=e}setup(e,t){const{version:r}=this.initializerContext.env.packageInfo,s=e.http.basePath.get(),o=(0,n.createStartServicesGetter)(e.getStartServices),i=()=>o().core.uiSettings.get("bfetch:disableCompression"),a=this.fetchStreaming("1",r,s,i),c=this.batchedFunction(a,i);return this.contract={fetchStreaming:a,batchedFunction:c},this.contract}start(e,t){return this.contract}stop(){}}function d(e){return new BfetchPublicPlugin(e)}},464:(e,t,r)=>{r.p=window.__kbnPublicPath__.bfetch},215:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},367:(e,t,r)=>{e.exports=r(497)(38422)},915:(e,t,r)=>{e.exports=r(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var n=s.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=s[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r(464),__kbnBundles__.define("plugin/bfetch/public",r,397)})();